!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.chordbox=e():t.chordbox=e()}(global,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>b});const r=require("path"),o=require("@svgdotjs/svg.js"),n=require("svgdom");function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){d(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function a(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function d(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}n.config.setFontDir((0,r.resolve)(__dirname,"assets/fonts"));var f=(0,n.createSVGWindow)(),c=f.document;(0,o.registerWindow)(f,c);var h={title:"Chord",frets:3,baseFret:1,dots:[],dotText:function(){return""},tunings:["E","A","D","G","B","E"],guages:[46,36,25,17,13,10]},u="Arial",l=285,p=350,g=50,x=50,v=50,y=10;const b={ChordBox:function(){function t(e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),d(this,"chordBoxOptions",h),this.renderer=(0,o.SVG)(),this.chordBoxOptions=s(s({},this.chordBoxOptions),e),this.validateChordBoxOptions(),this}var e,i;return e=t,i=[{key:"validateChordBoxOptions",value:function(){if(this.chordBoxOptions.frets<1||this.chordBoxOptions.frets>6)throw new Error("frets must be between 1 and 6");if(this.chordBoxOptions.baseFret<1||this.chordBoxOptions.baseFret>24)throw new Error("baseFret must be between 1 and 24");if(6!==this.chordBoxOptions.tunings.length)throw new Error("tuning must present for 6 strings only");if(6!==this.chordBoxOptions.guages.length)throw new Error("guages must present for 6 strings only")}},{key:"generateChordBoxBase",value:function(){var t=(0,o.SVG)().group(),e=(0,o.SVG)().rect(l,p).radius(5).fill("#000"),r=(0,o.SVG)().rect(275,340).fill("#fff");return t.add(e),t.add(r),e.back(),r.front(),r.move(5,5),t}},{key:"generateChordBoxTitle",value:function(){var t=(0,o.SVG)().group(),e=(0,o.SVG)().rect(275,g).fill("#000"),r=(0,o.SVG)().text(this.chordBoxOptions.title).attr({"font-size":24,"font-family":u}).fill("#fff").cx(137.5).cy(25);return t.add(e),t.add(r),e.back(),r.front(),t.move(5,5),t}},{key:"generatechordBoxFretLabels",value:function(){var t=this,e=(0,o.SVG)().group(),r=240/this.chordBoxOptions.frets,n=(0,o.SVG)().rect(x,240).fill("#fff"),i=Array.from(Array(this.chordBoxOptions.frets)).map((function(e,n){var i=(0,o.SVG)().group(),s=(0,o.SVG)().rect(x,r).fill("#fff"),a=(0,o.SVG)().text((t.chordBoxOptions.baseFret+n).toString()).attr({"font-size":16,"font-family":u}).fill("#000").cx(25).cy(r/2);return i.add(s),i.add(a),s.back(),a.front(),i.move(0,n*r),i}));return e.add(n),i.map((function(t){e.add(t)})),n.back(),e.move(5,105),e}},{key:"generatechordBoxStringLabels",value:function(){var t=this,e=(0,o.SVG)().group(),r=225/this.chordBoxOptions.tunings.length,n=(0,o.SVG)().rect(225,v).fill("#fff"),i=Array.from(Array(this.chordBoxOptions.tunings.length)).map((function(e,n){var i=(0,o.SVG)().group(),s=(0,o.SVG)().rect(r,v).fill("#fff"),a=(0,o.SVG)().text(t.chordBoxOptions.tunings[n]).attr({"font-size":16,"font-family":u}).fill("#000").cx(r/2).cy(25);return i.add(s),i.add(a),s.back(),a.front(),i.move(n*r,0),i}));return e.add(n),i.map((function(t){e.add(t)})),n.back(),e.move(55,55),e}},{key:"generateChordboxBody",value:function(){var t=(0,o.SVG)().group(),e=(0,o.SVG)().rect(225,240).fill("#fff");return t.add(e),t.move(55,105),t}},{key:"generatechordBoxNut",value:function(){var t=(0,o.SVG)().group(),e=(0,o.SVG)().rect(195,y).fill("none").radius(3);return 1===this.chordBoxOptions.baseFret&&e.fill("#000"),t.add(e),t.move(70,105),t}},{key:"generatechordBoxFrets",value:function(){var t=(0,o.SVG)().group(),e=230/this.chordBoxOptions.frets,r=(0,o.SVG)().rect(195,230).fill("#fff"),n=Array.from(Array(this.chordBoxOptions.frets)).map((function(t,r){var n=(0,o.SVG)().rect(195,3).fill("#C0C0C0");return n.move(0,r*e),n}));return t.add(r),n.map((function(e){t.add(e)})),t.back(),t.move(70,115),t}},{key:"generateChordBoxStrings",value:function(){var t=this,e=(0,o.SVG)().group(),r=225/this.chordBoxOptions.tunings.length,n=(0,o.SVG)().rect(225,230).fill("none"),i=Array.from(Array(this.chordBoxOptions.tunings.length)).map((function(e,n){var i=.125*t.chordBoxOptions.guages[n],s=(0,o.SVG)().rect(i,230).fill("#E48C5D");return s.move(n*r+r/2,0),s}));return e.add(n),i.map((function(t){e.add(t)})),e.back(),e.move(55,115),e}},{key:"generateChordBoxDots",value:function(){var t=this,e=(0,o.SVG)().group(),r=225/this.chordBoxOptions.tunings.length,n=230/this.chordBoxOptions.frets,i=this.chordBoxOptions.tunings.length,s=this.chordBoxOptions.guages,a=this.chordBoxOptions.dots,d=(0,o.SVG)().rect(225,230).fill("none"),f=Array.from(a).map((function(e){var a=(0,o.SVG)().group(),d=(0,o.SVG)().circle(30).fill("#000");d.cx((i-e.string)*r+r/2+.125*s[i-e.string]/2).cy((e.fret-1)*n+n/2),1===e.fret&&d.cy(n/2+y/(2*t.chordBoxOptions.frets));var f=(0,o.SVG)().text(t.chordBoxOptions.dotText(e)).attr({"font-size":12,"font-family":u}).fill("#fff");return f.cx((i-e.string)*r+r/2+.125*s[i-e.string]/2).cy((e.fret-1)*n+n/2),1===e.fret&&f.cy(n/2+y/(2*t.chordBoxOptions.frets)),a.add(d),a.add(f),d.back(),f.front(),a}));return e.add(d),f.map((function(t){e.add(t)})),e.back(),e.move(55,115),e}},{key:"setFontsDir",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,r.resolve)(__dirname,"./assets/fonts");return n.config.setFontDir(t),this}},{key:"setFrets",value:function(t){return this.chordBoxOptions.frets=t,this.validateChordBoxOptions(),this}},{key:"setBaseFret",value:function(t){return this.chordBoxOptions.baseFret=t,this.validateChordBoxOptions(),this}},{key:"setDots",value:function(t){return this.chordBoxOptions.dots=t,this.render(),this}},{key:"render",value:function(){return this.renderer.clear(),this.renderer.add(this.generateChordBoxBase()),this.renderer.add(this.generateChordBoxTitle()),this.renderer.add(this.generatechordBoxFretLabels()),this.renderer.add(this.generatechordBoxStringLabels()),this.renderer.add(this.generateChordboxBody()),this.renderer.add(this.generatechordBoxNut()),this.renderer.add(this.generatechordBoxFrets()),this.renderer.add(this.generateChordBoxStrings()),this.renderer.add(this.generateChordBoxDots()),this.renderer.attr({width:l,height:p}),this}},{key:"toSVG",value:function(){return this.renderer.svg()}},{key:"toSVGBase64URI",value:function(){return"data:image/svg+xml;base64,".concat(Buffer.from(this.renderer.svg()).toString("base64"))}}],i&&a(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}()};return e.default})()));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFPQSxFQUU1Qk8sS0FBSzZFLFNBRUU3RSxJQUNSLEcsb0JBRUQsV0F5QkUsT0F2QkFBLEtBQUtDLFNBQVM2RSxRQUdkOUUsS0FBS0MsU0FBU1ksSUFBSWIsS0FBSytFLHdCQUN2Qi9FLEtBQUtDLFNBQVNZLElBQUliLEtBQUtnRix5QkFFdkJoRixLQUFLQyxTQUFTWSxJQUFJYixLQUFLaUYsOEJBQ3ZCakYsS0FBS0MsU0FBU1ksSUFBSWIsS0FBS2tGLGdDQUd2QmxGLEtBQUtDLFNBQVNZLElBQUliLEtBQUttRix3QkFDdkJuRixLQUFLQyxTQUFTWSxJQUFJYixLQUFLb0YsdUJBQ3ZCcEYsS0FBS0MsU0FBU1ksSUFBSWIsS0FBS3FGLHlCQUN2QnJGLEtBQUtDLFNBQVNZLElBQUliLEtBQUtzRiwyQkFDdkJ0RixLQUFLQyxTQUFTWSxJQUFJYixLQUFLdUYsd0JBR3ZCdkYsS0FBS0MsU0FDRm9CLEtBQUssQ0FDSm1FLE1BQU8zRixFQUNQNEYsT0FBUTVGLElBR0xHLElBQ1IsRyxtQkFFRCxXQUNFLE9BQU9BLEtBQUtDLFNBQVN5RixLQUN0QixHLDRCQUVELFdBQ0UsTUFBTyw2QkFBUCxPQUFvQ0MsT0FBTzlELEtBQUs3QixLQUFLQyxTQUFTeUYsT0FBT3RELFNBQVMsVUFDL0UsSSx5RUF2Z0JHdEMsSSIsInNvdXJjZXMiOlsid2VicGFjazovL2Nob3JkYm94L3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9jaG9yZGJveC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9jaG9yZGJveC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vY2hvcmRib3gvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9jaG9yZGJveC9leHRlcm5hbCBub2RlLWNvbW1vbmpzIFwicGF0aFwiIiwid2VicGFjazovL2Nob3JkYm94L2V4dGVybmFsIGNvbW1vbmpzIFwiQHN2Z2RvdGpzL3N2Zy5qc1wiIiwid2VicGFjazovL2Nob3JkYm94L2V4dGVybmFsIGNvbW1vbmpzIFwic3ZnZG9tXCIiLCJ3ZWJwYWNrOi8vY2hvcmRib3gvLi9zcmMvY2hvcmRib3gudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcImNob3JkYm94XCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcImNob3JkYm94XCJdID0gZmFjdG9yeSgpO1xufSkoZ2xvYmFsLCAoKSA9PiB7XG5yZXR1cm4gIiwiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcInBhdGhcIik7IiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJAc3ZnZG90anMvc3ZnLmpzXCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwic3ZnZG9tXCIpOyIsImltcG9ydCB7IHJlc29sdmUgfSBmcm9tICdwYXRoJ1xuaW1wb3J0IHsgU1ZHLCByZWdpc3RlcldpbmRvdyB9IGZyb20gXCJAc3ZnZG90anMvc3ZnLmpzXCJcbmltcG9ydCB7IGNvbmZpZywgY3JlYXRlU1ZHV2luZG93IH0gZnJvbSBcInN2Z2RvbVwiXG5cbi8qIGVzbGludC1kaXNhYmxlICovXG5jb25maWcuc2V0Rm9udERpcihyZXNvbHZlKF9fZGlybmFtZSwgJ2Fzc2V0cy9mb250cycpKVxuY29uc3Qgd2luZG93ID0gY3JlYXRlU1ZHV2luZG93KClcbmNvbnN0IGRvY3VtZW50ID0gd2luZG93LmRvY3VtZW50XG5yZWdpc3RlcldpbmRvdyh3aW5kb3csIGRvY3VtZW50KVxuLyogZXNsaW50LWVuYWJsZSAqL1xuXG5pbXBvcnQge1xuICBDaG9yZEJveFJlbmRlcmVyLFxuICBDaG9yZEJveE9wdGlvbnMsXG4gIENob3JkQm94RG90XG59IGZyb20gJy4vdHlwZXMnXG5cbi8vIHRoZSB0aGluZ3MgYSB1c2VyIGNhbiBjb25maWd1cmVcbmNvbnN0IENob3JkQm94T3B0aW9uc0RlZmF1bHRzID0ge1xuICB0aXRsZTogJ0Nob3JkJyxcbiAgZnJldHM6IDMsXG4gIGJhc2VGcmV0OiAxLFxuICBkb3RzOiBbXSBhcyBDaG9yZEJveERvdFtdLFxuICBkb3RUZXh0OiAoKSA9PiAnJyxcbiAgdHVuaW5nczogWydFJywgJ0EnLCAnRCcsICdHJywgJ0InLCAnRSddLFxuICBndWFnZXM6IFs0NiwgMzYsIDI1LCAxNywgMTMsIDEwXSxcbn1cblxuY29uc3QgQ0hPUkRCT1hfU0VUVElOR1MgPSB7XG4gIC8vIHR5cG9ncmFwaHlcbiAgZm9udEZhbWlseTogJ0FyaWFsJyxcblxuICAvLyBiYXNlXG4gIHdpZHRoOiAyODUsXG4gIGhlaWdodDogMzUwLFxuICBwYWRkaW5nOiA1LFxuICByYWRpdXM6IDUsXG4gIGJvcmRlckZpbGxDb2xvcjogJyMwMDAnLFxuICBmaWxsQ29sb3I6ICcjZmZmJyxcblxuICAvLyB0aXRsZVxuICB0aXRsZVdpZHRoOiAyNzUsXG4gIHRpdGxlSGVpZ2h0OiA1MCxcbiAgdGl0bGVGaWxsQ29sb3I6ICcjMDAwJyxcbiAgdGl0bGVGb250U2l6ZTogMjQsXG4gIHRpdGxlRm9udENvbG9yOiAnI2ZmZicsXG5cbiAgZnJldExhYmVsc1dpZHRoOiA1MCxcbiAgZnJldExhYmVsc0NvbnRhaW5lckZpbGxDb2xvcjogJyNmZmYnLFxuXG4gIGZyZXRMYWJlbENvbnRhaW5lckZpbGxDb2xvcjogJyNmZmYnLFxuICBmcmV0TGFiZWxGb250U2l6ZTogMTYsXG4gIGZyZXRMYWJlbEZvbnRDb2xvcjogJyMwMDAnLFxuXG4gIHN0cmluZ0xhYmVsc0hlaWdodDogNTAsXG4gIHN0cmluZ0xhYmVsc0NvbnRhaW5lckZpbGxDb2xvcjogJyNmZmYnLFxuXG4gIHN0cmluZ0xhYmVsQ29udGFpbmVyRmlsbENvbG9yOiAnI2ZmZicsXG4gIHN0cmluZ0xhYmVsRm9udFNpemU6IDE2LFxuICBzdHJpbmdMYWJlbEZvbnRDb2xvcjogJyMwMDAnLFxuXG4gIGJvZHlGaWxsQ29sb3I6ICcjZmZmJyxcblxuICBudXRDb250YWluZXJQYWRkaW5nOiAxNSxcbiAgbnV0SGVpZ2h0OiAxMCxcbiAgbnV0UmFkaXVzOiAzLFxuICBudXRGaWxsQ29sb3I6ICcjMDAwJyxcblxuICBmcmV0c0NvbnRhaW5lckZpbGxDb2xvcjogJyNmZmYnLFxuICBcbiAgZnJldE1hcmtlckhlaWdodDogMyxcbiAgZnJldE1hcmtlckZpbGxDb2xvcjogJyNDMEMwQzAnLFxuXG4gIHN0cmluZ0ZpbGxDb2xvcjogJyNFNDhDNUQnLFxuXG4gIGRvdFNpemU6IDMwLFxuICBkb3RGb250U2l6ZTogMTIsXG4gIGRvdEZpbGxDb2xvcjogJyMwMDAnXG59XG5jbGFzcyBDaG9yZEJveCB7XG5cbiAgcHJpdmF0ZSByZW5kZXJlcjogQ2hvcmRCb3hSZW5kZXJlclxuXG4gIHByaXZhdGUgY2hvcmRCb3hPcHRpb25zOiBDaG9yZEJveE9wdGlvbnMgPSBDaG9yZEJveE9wdGlvbnNEZWZhdWx0c1xuXG4gIGNvbnN0cnVjdG9yIChjaG9yZEJveE9wdGlvbnM6IENob3JkQm94T3B0aW9ucykge1xuICAgIHRoaXMucmVuZGVyZXIgPSBTVkcoKVxuXG4gICAgLy8gYXNzaWduIG9wdGlvbnNcbiAgICB0aGlzLmNob3JkQm94T3B0aW9ucyA9IHtcbiAgICAgIC4uLnRoaXMuY2hvcmRCb3hPcHRpb25zLFxuICAgICAgLi4uY2hvcmRCb3hPcHRpb25zXG4gICAgfVxuXG4gICAgdGhpcy52YWxpZGF0ZUNob3JkQm94T3B0aW9ucygpXG5cbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZUNob3JkQm94T3B0aW9ucyAoKSB7XG4gICAgaWYgKHRoaXMuY2hvcmRCb3hPcHRpb25zLmZyZXRzIDwgMSB8fCB0aGlzLmNob3JkQm94T3B0aW9ucy5mcmV0cyA+IDYpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignZnJldHMgbXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDYnKVxuICAgIH1cblxuICAgIGlmICh0aGlzLmNob3JkQm94T3B0aW9ucy5iYXNlRnJldCA8IDEgfHwgdGhpcy5jaG9yZEJveE9wdGlvbnMuYmFzZUZyZXQgPiAyNCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdiYXNlRnJldCBtdXN0IGJlIGJldHdlZW4gMSBhbmQgMjQnKVxuICAgIH1cblxuICAgIGlmICh0aGlzLmNob3JkQm94T3B0aW9ucy50dW5pbmdzLmxlbmd0aCAhPT0gNikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd0dW5pbmcgbXVzdCBwcmVzZW50IGZvciA2IHN0cmluZ3Mgb25seScpXG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2hvcmRCb3hPcHRpb25zLmd1YWdlcy5sZW5ndGggIT09IDYpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignZ3VhZ2VzIG11c3QgcHJlc2VudCBmb3IgNiBzdHJpbmdzIG9ubHknKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVDaG9yZEJveEJhc2UgKCkge1xuICAgIGNvbnN0IGNob3JkQm94QmFzZUdyb3VwID0gU1ZHKCkuZ3JvdXAoKVxuXG4gICAgY29uc3QgY2hvcmRCb3hCYXNlQ29udGFpbmVyID0gU1ZHKClcbiAgICAgIC5yZWN0KFxuICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy53aWR0aCxcbiAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1MuaGVpZ2h0KVxuICAgICAgLnJhZGl1cyhDSE9SREJPWF9TRVRUSU5HUy5yYWRpdXMpXG4gICAgICAuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5ib3JkZXJGaWxsQ29sb3IpXG5cbiAgICBjb25zdCBjaG9yZEJveEJhc2UgPSAgU1ZHKClcbiAgICAgIC5yZWN0KFxuICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy53aWR0aC0oMipDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nKSxcbiAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1MuaGVpZ2h0LSgyKkNIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcpKVxuICAgICAgLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1MuZmlsbENvbG9yKVxuXG4gICAgY2hvcmRCb3hCYXNlR3JvdXAuYWRkKGNob3JkQm94QmFzZUNvbnRhaW5lcilcbiAgICBjaG9yZEJveEJhc2VHcm91cC5hZGQoY2hvcmRCb3hCYXNlKVxuXG4gICAgY2hvcmRCb3hCYXNlQ29udGFpbmVyLmJhY2soKVxuICAgIGNob3JkQm94QmFzZS5mcm9udCgpXG5cbiAgICBjaG9yZEJveEJhc2UubW92ZShcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcsXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nXG4gICAgKVxuXG4gICAgcmV0dXJuIGNob3JkQm94QmFzZUdyb3VwXG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQ2hvcmRCb3hUaXRsZSAoKSB7XG4gICAgY29uc3QgY2hvcmRCb3hUaXRsZUdyb3VwID0gU1ZHKCkuZ3JvdXAoKVxuXG4gICAgY29uc3QgY2hvcmRCb3hUaXRsZUNvbnRhaW5lciA9IFNWRygpXG4gICAgICAucmVjdChcbiAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVXaWR0aCxcbiAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVIZWlnaHRcbiAgICAgIClcbiAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLnRpdGxlRmlsbENvbG9yKVxuXG4gICAgY29uc3QgQ2hvcmRCb3hUaXRsZSA9IFNWRygpXG4gICAgICAudGV4dCh0aGlzLmNob3JkQm94T3B0aW9ucy50aXRsZSlcbiAgICAgIC5hdHRyKHtcbiAgICAgICAgJ2ZvbnQtc2l6ZSc6IENIT1JEQk9YX1NFVFRJTkdTLnRpdGxlRm9udFNpemUsXG4gICAgICAgICdmb250LWZhbWlseSc6IENIT1JEQk9YX1NFVFRJTkdTLmZvbnRGYW1pbHlcbiAgICAgIH0pXG4gICAgICAuZmlsbChDSE9SREJPWF9TRVRUSU5HUy50aXRsZUZvbnRDb2xvcilcbiAgICAgIC5jeChDSE9SREJPWF9TRVRUSU5HUy50aXRsZVdpZHRoLzIpXG4gICAgICAuY3koQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVIZWlnaHQvMilcblxuICAgIGNob3JkQm94VGl0bGVHcm91cC5hZGQoY2hvcmRCb3hUaXRsZUNvbnRhaW5lcilcbiAgICBjaG9yZEJveFRpdGxlR3JvdXAuYWRkKENob3JkQm94VGl0bGUpXG5cbiAgICBjaG9yZEJveFRpdGxlQ29udGFpbmVyLmJhY2soKVxuICAgIENob3JkQm94VGl0bGUuZnJvbnQoKVxuXG4gICAgY2hvcmRCb3hUaXRsZUdyb3VwLm1vdmUoXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nLFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZ1xuICAgIClcblxuICAgIHJldHVybiBjaG9yZEJveFRpdGxlR3JvdXBcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVjaG9yZEJveEZyZXRMYWJlbHMgKCkge1xuICAgIGNvbnN0IGNob3JkQm94RnJldExhYmVsc0dyb3VwID0gU1ZHKCkuZ3JvdXAoKVxuXG4gICAgY29uc3QgZnJldExhYmVsc0hlaWdodCA9IENIT1JEQk9YX1NFVFRJTkdTLmhlaWdodC0oMipDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nKS1DSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodC1DSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHRcbiAgICBjb25zdCBmcmV0TGFiZWxIZWlnaHQgPSBmcmV0TGFiZWxzSGVpZ2h0L3RoaXMuY2hvcmRCb3hPcHRpb25zLmZyZXRzXG5cbiAgICBjb25zdCBjaG9yZEJveEZyZXRMYWJlbHNDb250YWluZXIgPSBTVkcoKVxuICAgICAgLnJlY3QoXG4gICAgICAgIENIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbHNXaWR0aCxcbiAgICAgICAgZnJldExhYmVsc0hlaWdodFxuICAgICAgKVxuICAgICAgLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc0NvbnRhaW5lckZpbGxDb2xvcilcbiAgICBcbiAgICBjb25zdCBjaG9yZEJveEZyZXRib2FyZExhYmVscyA9IEFycmF5XG4gICAgICAuZnJvbShBcnJheSh0aGlzLmNob3JkQm94T3B0aW9ucy5mcmV0cykpXG4gICAgICAubWFwKChfLCBmcmV0TGFiZWxJbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBjaG9yZEJveEZyZXRMYWJlbEdyb3VwPSBTVkcoKS5ncm91cCgpXG5cbiAgICAgICAgY29uc3QgY2hvcmRCb3hGcmV0TGFiZWxDb250YWluZXIgPSBTVkcoKVxuICAgICAgICAgIC5yZWN0KFxuICAgICAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoLFxuICAgICAgICAgICAgZnJldExhYmVsSGVpZ2h0XG4gICAgICAgICAgKVxuICAgICAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbENvbnRhaW5lckZpbGxDb2xvcilcblxuICAgICAgICBjb25zdCBjaG9yZEJveEZyZXRMYWJlbFRleHQgPSBTVkcoKVxuICAgICAgICAgIC50ZXh0KCh0aGlzLmNob3JkQm94T3B0aW9ucy5iYXNlRnJldCArIGZyZXRMYWJlbEluZGV4KS50b1N0cmluZygpKVxuICAgICAgICAgIC5hdHRyKHtcbiAgICAgICAgICAgICdmb250LXNpemUnOiBDSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxGb250U2l6ZSxcbiAgICAgICAgICAgICdmb250LWZhbWlseSc6IENIT1JEQk9YX1NFVFRJTkdTLmZvbnRGYW1pbHlcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbEZvbnRDb2xvcilcbiAgICAgICAgICAuY3goQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoLzIpXG4gICAgICAgICAgLmN5KGZyZXRMYWJlbEhlaWdodC8yKVxuXG4gICAgICAgIGNob3JkQm94RnJldExhYmVsR3JvdXAuYWRkKGNob3JkQm94RnJldExhYmVsQ29udGFpbmVyKVxuICAgICAgICBjaG9yZEJveEZyZXRMYWJlbEdyb3VwLmFkZChjaG9yZEJveEZyZXRMYWJlbFRleHQpXG5cbiAgICAgICAgY2hvcmRCb3hGcmV0TGFiZWxDb250YWluZXIuYmFjaygpXG4gICAgICAgIGNob3JkQm94RnJldExhYmVsVGV4dC5mcm9udCgpXG5cbiAgICAgICAgY2hvcmRCb3hGcmV0TGFiZWxHcm91cC5tb3ZlKFxuICAgICAgICAgIDAsXG4gICAgICAgICAgZnJldExhYmVsSW5kZXgqZnJldExhYmVsSGVpZ2h0XG4gICAgICAgIClcblxuICAgICAgICByZXR1cm4gY2hvcmRCb3hGcmV0TGFiZWxHcm91cFxuICAgICAgfSlcblxuICAgIGNob3JkQm94RnJldExhYmVsc0dyb3VwLmFkZChjaG9yZEJveEZyZXRMYWJlbHNDb250YWluZXIpXG5cbiAgICBjaG9yZEJveEZyZXRib2FyZExhYmVsc1xuICAgICAgLm1hcChjaG9yZEJveEZyZXRMYWJlbCA9PiB7XG4gICAgICAgIGNob3JkQm94RnJldExhYmVsc0dyb3VwLmFkZChjaG9yZEJveEZyZXRMYWJlbClcbiAgICAgIH0pXG5cbiAgICBjaG9yZEJveEZyZXRMYWJlbHNDb250YWluZXIuYmFjaygpXG5cbiAgICBjaG9yZEJveEZyZXRMYWJlbHNHcm91cC5tb3ZlKFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyxcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcgKyBDSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodCArIENIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsc0hlaWdodFxuICAgIClcblxuICAgIHJldHVybiBjaG9yZEJveEZyZXRMYWJlbHNHcm91cFxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZWNob3JkQm94U3RyaW5nTGFiZWxzICgpIHtcbiAgICBjb25zdCBjaG9yZEJveFN0cmluZ0xhYmVsc0dyb3VwID0gU1ZHKCkuZ3JvdXAoKVxuXG4gICAgY29uc3Qgc3RyaW5nTGFiZWxzV2lkdGggPSBDSE9SREJPWF9TRVRUSU5HUy53aWR0aC0oMipDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nKS1DSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzV2lkdGhcbiAgICBjb25zdCBzdHJpbmdMYWJlbFdpZHRoID0gc3RyaW5nTGFiZWxzV2lkdGgvdGhpcy5jaG9yZEJveE9wdGlvbnMudHVuaW5ncy5sZW5ndGggLy8gc3RyaW5nIGNvdW50XG5cbiAgICBjb25zdCBjaG9yZEJveFN0cmluZ0xhYmVsc0NvbnRhaW5lciA9IFNWRygpXG4gICAgICAucmVjdChcbiAgICAgICAgc3RyaW5nTGFiZWxzV2lkdGgsXG4gICAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsc0hlaWdodFxuICAgICAgKVxuICAgICAgLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzQ29udGFpbmVyRmlsbENvbG9yKVxuICAgIFxuICAgIGNvbnN0IGNob3JkQm94U3RyaW5nYm9hcmRMYWJlbHMgPSBBcnJheVxuICAgICAgLmZyb20oQXJyYXkodGhpcy5jaG9yZEJveE9wdGlvbnMudHVuaW5ncy5sZW5ndGggLyogc3RyaW5nIGNvdW50ICovKSlcbiAgICAgIC5tYXAoKF8sIHN0cmluZ0xhYmVsSW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgY2hvcmRCb3hTdHJpbmdMYWJlbEdyb3VwPSBTVkcoKS5ncm91cCgpXG5cbiAgICAgICAgY29uc3QgY2hvcmRCb3hTdHJpbmdMYWJlbENvbnRhaW5lciA9IFNWRygpXG4gICAgICAgICAgLnJlY3QoXG4gICAgICAgICAgICBzdHJpbmdMYWJlbFdpZHRoLFxuICAgICAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0XG4gICAgICAgICAgKVxuICAgICAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsQ29udGFpbmVyRmlsbENvbG9yKVxuXG4gICAgICAgIGNvbnN0IGNob3JkQm94U3RyaW5nTGFiZWxUZXh0ID0gU1ZHKClcbiAgICAgICAgICAudGV4dCh0aGlzLmNob3JkQm94T3B0aW9ucy50dW5pbmdzW3N0cmluZ0xhYmVsSW5kZXhdKVxuICAgICAgICAgIC5hdHRyKHtcbiAgICAgICAgICAgICdmb250LXNpemUnOiBDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbEZvbnRTaXplLFxuICAgICAgICAgICAgJ2ZvbnQtZmFtaWx5JzogQ0hPUkRCT1hfU0VUVElOR1MuZm9udEZhbWlseVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxGb250Q29sb3IpXG4gICAgICAgICAgLmN4KHN0cmluZ0xhYmVsV2lkdGgvMilcbiAgICAgICAgICAuY3koQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0LzIpXG5cbiAgICAgICAgY2hvcmRCb3hTdHJpbmdMYWJlbEdyb3VwLmFkZChjaG9yZEJveFN0cmluZ0xhYmVsQ29udGFpbmVyKVxuICAgICAgICBjaG9yZEJveFN0cmluZ0xhYmVsR3JvdXAuYWRkKGNob3JkQm94U3RyaW5nTGFiZWxUZXh0KVxuXG4gICAgICAgIGNob3JkQm94U3RyaW5nTGFiZWxDb250YWluZXIuYmFjaygpXG4gICAgICAgIGNob3JkQm94U3RyaW5nTGFiZWxUZXh0LmZyb250KClcblxuICAgICAgICBjaG9yZEJveFN0cmluZ0xhYmVsR3JvdXAubW92ZShcbiAgICAgICAgICBzdHJpbmdMYWJlbEluZGV4KnN0cmluZ0xhYmVsV2lkdGgsXG4gICAgICAgICAgMCxcbiAgICAgICAgKVxuXG4gICAgICAgIHJldHVybiBjaG9yZEJveFN0cmluZ0xhYmVsR3JvdXBcbiAgICAgIH0pXG5cbiAgICBjaG9yZEJveFN0cmluZ0xhYmVsc0dyb3VwLmFkZChjaG9yZEJveFN0cmluZ0xhYmVsc0NvbnRhaW5lcilcblxuICAgIGNob3JkQm94U3RyaW5nYm9hcmRMYWJlbHNcbiAgICAgIC5tYXAoY2hvcmRCb3hTdHJpbmdMYWJlbCA9PiB7XG4gICAgICAgIGNob3JkQm94U3RyaW5nTGFiZWxzR3JvdXAuYWRkKGNob3JkQm94U3RyaW5nTGFiZWwpXG4gICAgICB9KVxuXG4gICAgY2hvcmRCb3hTdHJpbmdMYWJlbHNDb250YWluZXIuYmFjaygpXG5cbiAgICBjaG9yZEJveFN0cmluZ0xhYmVsc0dyb3VwLm1vdmUoXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nICsgQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoLFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyArIENIT1JEQk9YX1NFVFRJTkdTLnRpdGxlSGVpZ2h0LFxuICAgIClcblxuICAgIHJldHVybiBjaG9yZEJveFN0cmluZ0xhYmVsc0dyb3VwXG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQ2hvcmRib3hCb2R5ICgpIHtcbiAgICBjb25zdCBjaG9yZEJveEJvZHlHcm91cCA9IFNWRygpLmdyb3VwKClcblxuICAgIGNvbnN0IGNob3JkQm94Qm9keSA9IFNWRygpXG4gICAgICAucmVjdChcbiAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1Mud2lkdGgtKDIqQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyktQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoLFxuICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy5oZWlnaHQtKDIqQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyktQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVIZWlnaHQtQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0XG4gICAgICApXG4gICAgICAuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5ib2R5RmlsbENvbG9yKVxuXG4gICAgY2hvcmRCb3hCb2R5R3JvdXAuYWRkKGNob3JkQm94Qm9keSlcblxuICAgIGNob3JkQm94Qm9keUdyb3VwLm1vdmUoXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nK0NIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbHNXaWR0aCxcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcrQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVIZWlnaHQrQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0XG4gICAgKVxuXG4gICAgcmV0dXJuIGNob3JkQm94Qm9keUdyb3VwXG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlY2hvcmRCb3hOdXQgKCkge1xuICAgIGNvbnN0IGNob3JkQm94TnV0R3JvdXAgPSBTVkcoKS5ncm91cCgpXG5cbiAgICBjb25zdCBjaG9yZEJveE51dENvbnRhaW5lciA9IFNWRygpXG4gICAgICAucmVjdChcbiAgICAgICAgKENIT1JEQk9YX1NFVFRJTkdTLndpZHRoLSgyKkNIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcpLUNIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbHNXaWR0aCktKDIqQ0hPUkRCT1hfU0VUVElOR1MubnV0Q29udGFpbmVyUGFkZGluZyksXG4gICAgICAgIENIT1JEQk9YX1NFVFRJTkdTLm51dEhlaWdodFxuICAgICAgKVxuICAgICAgLmZpbGwoJ25vbmUnKSAvLyBoaWRlIGJ5IGRlZmF1bHRcbiAgICAgIC5yYWRpdXMoQ0hPUkRCT1hfU0VUVElOR1MubnV0UmFkaXVzKVxuICAgIFxuICAgIC8vIHRoZSBudXQgc2hvdWxkIG9ubHkgYmUgdmlzaWJsZSBpZiBiYXNlRnJldCA9PT0gMVxuICAgIGlmICh0aGlzLmNob3JkQm94T3B0aW9ucy5iYXNlRnJldCA9PT0gMSkge1xuICAgICAgY2hvcmRCb3hOdXRDb250YWluZXIuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5udXRGaWxsQ29sb3IpXG4gICAgfVxuXG4gICAgY2hvcmRCb3hOdXRHcm91cC5hZGQoY2hvcmRCb3hOdXRDb250YWluZXIpXG5cbiAgICBjaG9yZEJveE51dEdyb3VwLm1vdmUoXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nK0NIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbHNXaWR0aCtDSE9SREJPWF9TRVRUSU5HUy5udXRDb250YWluZXJQYWRkaW5nLFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZytDSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodCtDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHRcbiAgICApXG5cbiAgICByZXR1cm4gY2hvcmRCb3hOdXRHcm91cFxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZWNob3JkQm94RnJldHMgKCkge1xuICAgIGNvbnN0IGNob3JkQm94RnJldHNHcm91cCA9IFNWRygpLmdyb3VwKClcblxuICAgIGNvbnN0IGZyZXRzV2lkdGggPSAoQ0hPUkRCT1hfU0VUVElOR1Mud2lkdGgtKDIqQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyktQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoKS0oMipDSE9SREJPWF9TRVRUSU5HUy5udXRDb250YWluZXJQYWRkaW5nKVxuICAgIGNvbnN0IGZyZXRzSGVpZ2h0ID0gQ0hPUkRCT1hfU0VUVElOR1MuaGVpZ2h0LSgyKkNIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcpLUNIT1JEQk9YX1NFVFRJTkdTLnRpdGxlSGVpZ2h0LUNIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsc0hlaWdodC1DSE9SREJPWF9TRVRUSU5HUy5udXRIZWlnaHRcbiAgICBjb25zdCBmcmV0SGVpZ2h0ID0gZnJldHNIZWlnaHQvdGhpcy5jaG9yZEJveE9wdGlvbnMuZnJldHNcblxuICAgIGNvbnN0IGNob3JkQm94RnJldHNDb250YWluZXIgPSBTVkcoKVxuICAgICAgLnJlY3QoXG4gICAgICAgIGZyZXRzV2lkdGgsXG4gICAgICAgIGZyZXRzSGVpZ2h0XG4gICAgICApLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1MuZnJldHNDb250YWluZXJGaWxsQ29sb3IpXG5cbiAgICBjb25zdCBjaG9yZEJveEZyZXRNYXJrZXJzID0gQXJyYXlcbiAgICAgIC5mcm9tKEFycmF5KHRoaXMuY2hvcmRCb3hPcHRpb25zLmZyZXRzKSlcbiAgICAgIC5tYXAoKF8sIGZyZXRNYXJrZXJJbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBmcmV0TWFya2VyID0gU1ZHKClcbiAgICAgICAgICAucmVjdChcbiAgICAgICAgICAgIGZyZXRzV2lkdGgsXG4gICAgICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy5mcmV0TWFya2VySGVpZ2h0XG4gICAgICAgICAgKVxuICAgICAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLmZyZXRNYXJrZXJGaWxsQ29sb3IpXG5cbiAgICAgICAgZnJldE1hcmtlci5tb3ZlKFxuICAgICAgICAgIDAsXG4gICAgICAgICAgZnJldE1hcmtlckluZGV4KmZyZXRIZWlnaHQsXG4gICAgICAgIClcblxuICAgICAgICByZXR1cm4gZnJldE1hcmtlclxuICAgICAgfSlcblxuICAgIGNob3JkQm94RnJldHNHcm91cC5hZGQoY2hvcmRCb3hGcmV0c0NvbnRhaW5lcilcblxuICAgIGNob3JkQm94RnJldE1hcmtlcnMubWFwKGZyZXRNYXJrZXIgPT4ge1xuICAgICAgY2hvcmRCb3hGcmV0c0dyb3VwLmFkZChmcmV0TWFya2VyKVxuICAgIH0pXG5cbiAgICBjaG9yZEJveEZyZXRzR3JvdXAuYmFjaygpXG5cbiAgICBjaG9yZEJveEZyZXRzR3JvdXAubW92ZShcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcrQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoK0NIT1JEQk9YX1NFVFRJTkdTLm51dENvbnRhaW5lclBhZGRpbmcsXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nK0NIT1JEQk9YX1NFVFRJTkdTLnRpdGxlSGVpZ2h0K0NIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsc0hlaWdodCtDSE9SREJPWF9TRVRUSU5HUy5udXRIZWlnaHRcbiAgICApXG5cbiAgICByZXR1cm4gY2hvcmRCb3hGcmV0c0dyb3VwXG4gIH1cbiAgXG4gIHByaXZhdGUgZ2VuZXJhdGVDaG9yZEJveFN0cmluZ3MgKCkge1xuICAgIGNvbnN0IGNob3JkQm94U3RyaW5nc0dyb3VwID0gU1ZHKCkuZ3JvdXAoKVxuXG4gICAgY29uc3Qgc3RyaW5nc1dpZHRoID0gQ0hPUkRCT1hfU0VUVElOR1Mud2lkdGgtKDIqQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyktQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoXG4gICAgY29uc3Qgc3RyaW5nc0hlaWdodCA9IENIT1JEQk9YX1NFVFRJTkdTLmhlaWdodC0oMipDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nKS1DSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodC1DSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHQtQ0hPUkRCT1hfU0VUVElOR1MubnV0SGVpZ2h0XG4gICAgY29uc3Qgc3RyaW5nV2lkdGggPSBzdHJpbmdzV2lkdGgvdGhpcy5jaG9yZEJveE9wdGlvbnMudHVuaW5ncy5sZW5ndGhcbiAgICBjb25zdCBzdHJpbmdHdWFnZVNjYWxlRmFjdG9yID0gMC4xMjVcblxuICAgIGNvbnN0IGNob3JkQm94U3RyaW5nc0NvbnRhaW5lciA9IFNWRygpXG4gICAgICAucmVjdChcbiAgICAgICAgc3RyaW5nc1dpZHRoLFxuICAgICAgICBzdHJpbmdzSGVpZ2h0XG4gICAgICApLmZpbGwoJ25vbmUnKSAvLyBzbyBmcmV0cyBzaG93IHRocm91Z2hcblxuICAgIGNvbnN0IGNob3JkQm94U3RyaW5ncyA9IEFycmF5XG4gICAgICAuZnJvbShBcnJheSh0aGlzLmNob3JkQm94T3B0aW9ucy50dW5pbmdzLmxlbmd0aCkpXG4gICAgICAubWFwKChfLCBzdHJpbmdJbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBzdHJpbmdHdWFnZSA9IHRoaXMuY2hvcmRCb3hPcHRpb25zLmd1YWdlc1tzdHJpbmdJbmRleF0gKiBzdHJpbmdHdWFnZVNjYWxlRmFjdG9yXG5cbiAgICAgICAgY29uc3Qgc3RyaW5nID0gU1ZHKClcbiAgICAgICAgICAucmVjdChzdHJpbmdHdWFnZSwgc3RyaW5nc0hlaWdodClcbiAgICAgICAgICAuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdGaWxsQ29sb3IpXG5cbiAgICAgICAgc3RyaW5nLm1vdmUoXG4gICAgICAgICAgc3RyaW5nSW5kZXgqc3RyaW5nV2lkdGggKyBzdHJpbmdXaWR0aC8yLFxuICAgICAgICAgIDAsXG4gICAgICAgIClcblxuICAgICAgICByZXR1cm4gc3RyaW5nXG4gICAgICB9KVxuXG4gICAgY2hvcmRCb3hTdHJpbmdzR3JvdXAuYWRkKGNob3JkQm94U3RyaW5nc0NvbnRhaW5lcilcblxuICAgIGNob3JkQm94U3RyaW5ncy5tYXAoc3RyaW5nID0+IHtcbiAgICAgIGNob3JkQm94U3RyaW5nc0dyb3VwLmFkZChzdHJpbmcpXG4gICAgfSlcblxuICAgIGNob3JkQm94U3RyaW5nc0dyb3VwLmJhY2soKVxuXG4gICAgY2hvcmRCb3hTdHJpbmdzR3JvdXAubW92ZShcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcrQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoLFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZytDSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodCtDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHQrQ0hPUkRCT1hfU0VUVElOR1MubnV0SGVpZ2h0XG4gICAgKVxuXG4gICAgcmV0dXJuIGNob3JkQm94U3RyaW5nc0dyb3VwXG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQ2hvcmRCb3hEb3RzICgpIHtcbiAgICBjb25zdCBjaG9yZEJveERvdHNHcm91cCA9IFNWRygpLmdyb3VwKClcblxuICAgIGNvbnN0IGRvdHNXaWR0aCA9IENIT1JEQk9YX1NFVFRJTkdTLndpZHRoLSgyKkNIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcpLUNIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbHNXaWR0aFxuICAgIGNvbnN0IGRvdHNIZWlnaHQgPSBDSE9SREJPWF9TRVRUSU5HUy5oZWlnaHQtKDIqQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyktQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVIZWlnaHQtQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0LUNIT1JEQk9YX1NFVFRJTkdTLm51dEhlaWdodFxuICAgIGNvbnN0IGRvdFdpZHRoID0gZG90c1dpZHRoL3RoaXMuY2hvcmRCb3hPcHRpb25zLnR1bmluZ3MubGVuZ3RoXG4gICAgY29uc3QgZG90SGVpZ2h0ID0gZG90c0hlaWdodC90aGlzLmNob3JkQm94T3B0aW9ucy5mcmV0c1xuXG4gICAgY29uc3Qgc3RyaW5ncyA9IHRoaXMuY2hvcmRCb3hPcHRpb25zLnR1bmluZ3MubGVuZ3RoXG4gICAgY29uc3QgZ3VhZ2VzID0gdGhpcy5jaG9yZEJveE9wdGlvbnMuZ3VhZ2VzXG4gICAgY29uc3Qgc3RyaW5nR3VhZ2VTY2FsZUZhY3RvciA9IDAuMTI1XG5cbiAgICBjb25zdCBvcHRpb25zRG90cyA9IHRoaXMuY2hvcmRCb3hPcHRpb25zLmRvdHNcblxuICAgIGNvbnN0IGNob3JkQm94RG90c0NvbnRhaW5lciA9IFNWRygpXG4gICAgICAucmVjdChcbiAgICAgICAgZG90c1dpZHRoLFxuICAgICAgICBkb3RzSGVpZ2h0XG4gICAgICApLmZpbGwoJ25vbmUnKSAvLyBzbyBkb3RzIHNob3cgdGhyb3VnaFxuXG4gICAgY29uc3QgY2hvcmRCb3hEb3RzID0gQXJyYXlcbiAgICAgIC5mcm9tKG9wdGlvbnNEb3RzKVxuICAgICAgLm1hcChkb3QgPT4ge1xuICAgICAgICBjb25zdCBkb3RHcm91cCA9IFNWRygpLmdyb3VwKClcblxuICAgICAgICBjb25zdCBkb3RDb250YWluZXIgPSBTVkcoKVxuICAgICAgICAgIC5jaXJjbGUoQ0hPUkRCT1hfU0VUVElOR1MuZG90U2l6ZSlcbiAgICAgICAgICAuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5kb3RGaWxsQ29sb3IpXG5cbiAgICAgICAgZG90Q29udGFpbmVyXG4gICAgICAgICAgLmN4KCgoc3RyaW5ncyAtIGRvdC5zdHJpbmcpICogZG90V2lkdGggKyBkb3RXaWR0aC8yKSArIChndWFnZXNbc3RyaW5ncyAtIGRvdC5zdHJpbmddICogc3RyaW5nR3VhZ2VTY2FsZUZhY3RvcikgLyAyKVxuICAgICAgICAgIC5jeSgoZG90LmZyZXQtMSkgKiBkb3RIZWlnaHQgKyBkb3RIZWlnaHQvMilcblxuICAgICAgICAvLyBkdWUgdG8gb3VyIGNvbnRhaW5lciBkaW1lbnNpb25zXG4gICAgICAgIGlmIChkb3QuZnJldCA9PT0gMSkge1xuICAgICAgICAgIGRvdENvbnRhaW5lci5jeShkb3RIZWlnaHQvMiArIENIT1JEQk9YX1NFVFRJTkdTLm51dEhlaWdodC8oMip0aGlzLmNob3JkQm94T3B0aW9ucy5mcmV0cykpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkb3RUZXh0ID0gU1ZHKClcbiAgICAgICAgICAudGV4dCh0aGlzLmNob3JkQm94T3B0aW9ucy5kb3RUZXh0KGRvdCkpXG4gICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgJ2ZvbnQtc2l6ZSc6IENIT1JEQk9YX1NFVFRJTkdTLmRvdEZvbnRTaXplLFxuICAgICAgICAgICAgJ2ZvbnQtZmFtaWx5JzogQ0hPUkRCT1hfU0VUVElOR1MuZm9udEZhbWlseVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbGwoJyNmZmYnKVxuXG4gICAgICAgIGRvdFRleHRcbiAgICAgICAgICAuY3goKChzdHJpbmdzIC0gZG90LnN0cmluZykgKiBkb3RXaWR0aCArIGRvdFdpZHRoLzIpICsgKGd1YWdlc1tzdHJpbmdzIC0gZG90LnN0cmluZ10gKiBzdHJpbmdHdWFnZVNjYWxlRmFjdG9yKSAvIDIpXG4gICAgICAgICAgLmN5KChkb3QuZnJldC0xKSAqIGRvdEhlaWdodCArIGRvdEhlaWdodC8yKVxuXG4gICAgICAgIC8vIGR1ZSB0byBvdXIgY29udGFpbmVyIGRpbWVuc2lvbnNcbiAgICAgICAgaWYgKGRvdC5mcmV0ID09PSAxKSB7XG4gICAgICAgICAgZG90VGV4dC5jeShkb3RIZWlnaHQvMiArIENIT1JEQk9YX1NFVFRJTkdTLm51dEhlaWdodC8oMip0aGlzLmNob3JkQm94T3B0aW9ucy5mcmV0cykpXG4gICAgICAgIH1cblxuICAgICAgICBkb3RHcm91cC5hZGQoZG90Q29udGFpbmVyKVxuICAgICAgICBkb3RHcm91cC5hZGQoZG90VGV4dClcblxuICAgICAgICBkb3RDb250YWluZXIuYmFjaygpXG4gICAgICAgIGRvdFRleHQuZnJvbnQoKVxuXG4gICAgICAgIHJldHVybiBkb3RHcm91cFxuICAgICAgfSlcblxuICAgIGNob3JkQm94RG90c0dyb3VwLmFkZChjaG9yZEJveERvdHNDb250YWluZXIpXG5cbiAgICBjaG9yZEJveERvdHMubWFwKGRvdCA9PiB7XG4gICAgICBjaG9yZEJveERvdHNHcm91cC5hZGQoZG90KVxuICAgIH0pXG5cbiAgICBjaG9yZEJveERvdHNHcm91cC5iYWNrKClcblxuICAgIGNob3JkQm94RG90c0dyb3VwLm1vdmUoXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nK0NIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbHNXaWR0aCxcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcrQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVIZWlnaHQrQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0K0NIT1JEQk9YX1NFVFRJTkdTLm51dEhlaWdodFxuICAgIClcblxuICAgIHJldHVybiBjaG9yZEJveERvdHNHcm91cFxuICB9XG5cbiAgc2V0Rm9udHNEaXIgKGZvbnRzRGlyOiBzdHJpbmcgPSByZXNvbHZlKF9fZGlybmFtZSwgJy4vYXNzZXRzL2ZvbnRzJykpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICBjb25maWcuc2V0Rm9udERpcihmb250c0RpcilcblxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICBzZXRGcmV0cyAoZnJldHM6IG51bWJlcikge1xuICAgIHRoaXMuY2hvcmRCb3hPcHRpb25zLmZyZXRzID0gZnJldHNcblxuICAgIHRoaXMudmFsaWRhdGVDaG9yZEJveE9wdGlvbnMoKVxuXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIHNldEJhc2VGcmV0IChiYXNlRnJldDogbnVtYmVyKSB7XG4gICAgdGhpcy5jaG9yZEJveE9wdGlvbnMuYmFzZUZyZXQgPSBiYXNlRnJldFxuXG4gICAgdGhpcy52YWxpZGF0ZUNob3JkQm94T3B0aW9ucygpXG5cbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgc2V0RG90cyAoZG90czogQ2hvcmRCb3hEb3RbXSkge1xuICAgIHRoaXMuY2hvcmRCb3hPcHRpb25zLmRvdHMgPSBkb3RzXG5cbiAgICB0aGlzLnJlbmRlcigpXG5cbiAgICByZXR1cm4gdGhpc1xuICB9XG4gIFxuICByZW5kZXIgKCkge1xuICAgIC8vIGFsd2F5cyBjbGVhciB0aGUgcmVuZGVyZXJcbiAgICB0aGlzLnJlbmRlcmVyLmNsZWFyKClcblxuICAgIC8vIGJ1aWxkIGl0IHVwIGluIGxheWVyc1xuICAgIHRoaXMucmVuZGVyZXIuYWRkKHRoaXMuZ2VuZXJhdGVDaG9yZEJveEJhc2UoKSlcbiAgICB0aGlzLnJlbmRlcmVyLmFkZCh0aGlzLmdlbmVyYXRlQ2hvcmRCb3hUaXRsZSgpKVxuXG4gICAgdGhpcy5yZW5kZXJlci5hZGQodGhpcy5nZW5lcmF0ZWNob3JkQm94RnJldExhYmVscygpKVxuICAgIHRoaXMucmVuZGVyZXIuYWRkKHRoaXMuZ2VuZXJhdGVjaG9yZEJveFN0cmluZ0xhYmVscygpKVxuXG4gICAgLy8gLy8gYnVpbGQgdGhlIGJvZHkgcGFydHNcbiAgICB0aGlzLnJlbmRlcmVyLmFkZCh0aGlzLmdlbmVyYXRlQ2hvcmRib3hCb2R5KCkpXG4gICAgdGhpcy5yZW5kZXJlci5hZGQodGhpcy5nZW5lcmF0ZWNob3JkQm94TnV0KCkpXG4gICAgdGhpcy5yZW5kZXJlci5hZGQodGhpcy5nZW5lcmF0ZWNob3JkQm94RnJldHMoKSlcbiAgICB0aGlzLnJlbmRlcmVyLmFkZCh0aGlzLmdlbmVyYXRlQ2hvcmRCb3hTdHJpbmdzKCkpXG4gICAgdGhpcy5yZW5kZXJlci5hZGQodGhpcy5nZW5lcmF0ZUNob3JkQm94RG90cygpKVxuXG4gICAgLy8gZml4ZXMgY2hyb21lIHJlbmRlcmluZyBpc3N1ZVxuICAgIHRoaXMucmVuZGVyZXJcbiAgICAgIC5hdHRyKHtcbiAgICAgICAgd2lkdGg6IENIT1JEQk9YX1NFVFRJTkdTLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IENIT1JEQk9YX1NFVFRJTkdTLmhlaWdodCxcbiAgICAgIH0pXG5cbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgdG9TVkcgKCkge1xuICAgIHJldHVybiB0aGlzLnJlbmRlcmVyLnN2ZygpXG4gIH1cblxuICB0b1NWR0Jhc2U2NFVSSSAoKSB7XG4gICAgcmV0dXJuIGBkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCR7QnVmZmVyLmZyb20odGhpcy5yZW5kZXJlci5zdmcoKSkudG9TdHJpbmcoXCJiYXNlNjRcIil9YFxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHsgQ2hvcmRCb3ggfVxuZXhwb3J0IHsgQ2hvcmRCb3ggfSJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJnbG9iYWwiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicmVxdWlyZSIsImNvbmZpZyIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJ3aW5kb3ciLCJjcmVhdGVTVkdXaW5kb3ciLCJkb2N1bWVudCIsInJlZ2lzdGVyV2luZG93IiwiQ2hvcmRCb3hPcHRpb25zRGVmYXVsdHMiLCJ0aXRsZSIsImZyZXRzIiwiYmFzZUZyZXQiLCJkb3RzIiwiZG90VGV4dCIsInR1bmluZ3MiLCJndWFnZXMiLCJDSE9SREJPWF9TRVRUSU5HUyIsIkNob3JkQm94IiwiY2hvcmRCb3hPcHRpb25zIiwidGhpcyIsInJlbmRlcmVyIiwiU1ZHIiwidmFsaWRhdGVDaG9yZEJveE9wdGlvbnMiLCJFcnJvciIsImxlbmd0aCIsImNob3JkQm94QmFzZUdyb3VwIiwiZ3JvdXAiLCJjaG9yZEJveEJhc2VDb250YWluZXIiLCJyZWN0IiwicmFkaXVzIiwiZmlsbCIsImNob3JkQm94QmFzZSIsImFkZCIsImJhY2siLCJmcm9udCIsIm1vdmUiLCJjaG9yZEJveFRpdGxlR3JvdXAiLCJjaG9yZEJveFRpdGxlQ29udGFpbmVyIiwiQ2hvcmRCb3hUaXRsZSIsInRleHQiLCJhdHRyIiwiY3giLCJjeSIsImNob3JkQm94RnJldExhYmVsc0dyb3VwIiwiZnJldExhYmVsSGVpZ2h0IiwiY2hvcmRCb3hGcmV0TGFiZWxzQ29udGFpbmVyIiwiY2hvcmRCb3hGcmV0Ym9hcmRMYWJlbHMiLCJBcnJheSIsImZyb20iLCJtYXAiLCJfIiwiZnJldExhYmVsSW5kZXgiLCJjaG9yZEJveEZyZXRMYWJlbEdyb3VwIiwiY2hvcmRCb3hGcmV0TGFiZWxDb250YWluZXIiLCJjaG9yZEJveEZyZXRMYWJlbFRleHQiLCJ0b1N0cmluZyIsImNob3JkQm94RnJldExhYmVsIiwiY2hvcmRCb3hTdHJpbmdMYWJlbHNHcm91cCIsInN0cmluZ0xhYmVsV2lkdGgiLCJjaG9yZEJveFN0cmluZ0xhYmVsc0NvbnRhaW5lciIsImNob3JkQm94U3RyaW5nYm9hcmRMYWJlbHMiLCJzdHJpbmdMYWJlbEluZGV4IiwiY2hvcmRCb3hTdHJpbmdMYWJlbEdyb3VwIiwiY2hvcmRCb3hTdHJpbmdMYWJlbENvbnRhaW5lciIsImNob3JkQm94U3RyaW5nTGFiZWxUZXh0IiwiY2hvcmRCb3hTdHJpbmdMYWJlbCIsImNob3JkQm94Qm9keUdyb3VwIiwiY2hvcmRCb3hCb2R5IiwiY2hvcmRCb3hOdXRHcm91cCIsImNob3JkQm94TnV0Q29udGFpbmVyIiwiY2hvcmRCb3hGcmV0c0dyb3VwIiwiZnJldEhlaWdodCIsImNob3JkQm94RnJldHNDb250YWluZXIiLCJjaG9yZEJveEZyZXRNYXJrZXJzIiwiZnJldE1hcmtlckluZGV4IiwiZnJldE1hcmtlciIsImNob3JkQm94U3RyaW5nc0dyb3VwIiwic3RyaW5nV2lkdGgiLCJjaG9yZEJveFN0cmluZ3NDb250YWluZXIiLCJjaG9yZEJveFN0cmluZ3MiLCJzdHJpbmdJbmRleCIsInN0cmluZ0d1YWdlIiwic3RyaW5nIiwiY2hvcmRCb3hEb3RzR3JvdXAiLCJkb3RXaWR0aCIsImRvdEhlaWdodCIsInN0cmluZ3MiLCJvcHRpb25zRG90cyIsImNob3JkQm94RG90c0NvbnRhaW5lciIsImNob3JkQm94RG90cyIsImRvdCIsImRvdEdyb3VwIiwiZG90Q29udGFpbmVyIiwiY2lyY2xlIiwiZnJldCIsImZvbnRzRGlyIiwicmVuZGVyIiwiY2xlYXIiLCJnZW5lcmF0ZUNob3JkQm94QmFzZSIsImdlbmVyYXRlQ2hvcmRCb3hUaXRsZSIsImdlbmVyYXRlY2hvcmRCb3hGcmV0TGFiZWxzIiwiZ2VuZXJhdGVjaG9yZEJveFN0cmluZ0xhYmVscyIsImdlbmVyYXRlQ2hvcmRib3hCb2R5IiwiZ2VuZXJhdGVjaG9yZEJveE51dCIsImdlbmVyYXRlY2hvcmRCb3hGcmV0cyIsImdlbmVyYXRlQ2hvcmRCb3hTdHJpbmdzIiwiZ2VuZXJhdGVDaG9yZEJveERvdHMiLCJ3aWR0aCIsImhlaWdodCIsInN2ZyIsIkJ1ZmZlciJdLCJzb3VyY2VSb290IjoiIn0=