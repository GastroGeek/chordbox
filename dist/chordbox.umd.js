!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.chordbox=t():e.chordbox=t()}(global,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>b});const r=require("path"),o=require("@svgdotjs/svg.js"),n=require("svgdom");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}n.config.setFontDir((0,r.resolve)(__dirname,"assets/fonts")).setFontFamilyMappings({"sans-serif":"nahnah.ttf"});var f=(0,n.createSVGWindow)(),c=f.document;(0,o.registerWindow)(f,c);var h={title:"Chord",frets:3,baseFret:1,dots:[],dotText:function(){return""},tunings:["E","A","D","G","B","E"],guages:[46,36,25,17,13,10]},u="Arial",l=285,g=350,p=50,x=50,v=50,y=10;const b={ChordBox:function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"chordBoxOptions",h),this.renderer=(0,o.SVG)(),this.chordBoxOptions=s(s({},this.chordBoxOptions),t),this.validateChordBoxOptions(),this}var t,i;return t=e,i=[{key:"validateChordBoxOptions",value:function(){if(this.chordBoxOptions.frets<1||this.chordBoxOptions.frets>6)throw new Error("frets must be between 1 and 6");if(this.chordBoxOptions.baseFret<1||this.chordBoxOptions.baseFret>24)throw new Error("baseFret must be between 1 and 24");if(6!==this.chordBoxOptions.tunings.length)throw new Error("tuning must present for 6 strings only");if(6!==this.chordBoxOptions.guages.length)throw new Error("guages must present for 6 strings only")}},{key:"generateChordBoxBase",value:function(){var e=(0,o.SVG)().group(),t=(0,o.SVG)().rect(l,g).radius(5).fill("#000"),r=(0,o.SVG)().rect(275,340).fill("#fff");return e.add(t),e.add(r),t.back(),r.front(),r.move(5,5),e}},{key:"generateChordBoxTitle",value:function(){var e=(0,o.SVG)().group(),t=(0,o.SVG)().rect(275,p).fill("#000"),r=(0,o.SVG)().text(this.chordBoxOptions.title).attr({"font-size":24,"font-family":u}).fill("#fff").cx(137.5).cy(25);return e.add(t),e.add(r),t.back(),r.front(),e.move(5,5),e}},{key:"generatechordBoxFretLabels",value:function(){var e=this,t=(0,o.SVG)().group(),r=240/this.chordBoxOptions.frets,n=(0,o.SVG)().rect(x,240).fill("#fff"),i=Array.from(Array(this.chordBoxOptions.frets)).map((function(t,n){var i=(0,o.SVG)().group(),s=(0,o.SVG)().rect(x,r).fill("#fff"),a=(0,o.SVG)().text((e.chordBoxOptions.baseFret+n).toString()).attr({"font-size":16,"font-family":u}).fill("#000").cx(25).cy(r/2);return i.add(s),i.add(a),s.back(),a.front(),i.move(0,n*r),i}));return t.add(n),i.map((function(e){t.add(e)})),n.back(),t.move(5,105),t}},{key:"generatechordBoxStringLabels",value:function(){var e=this,t=(0,o.SVG)().group(),r=225/this.chordBoxOptions.tunings.length,n=(0,o.SVG)().rect(225,v).fill("#fff"),i=Array.from(Array(this.chordBoxOptions.tunings.length)).map((function(t,n){var i=(0,o.SVG)().group(),s=(0,o.SVG)().rect(r,v).fill("#fff"),a=(0,o.SVG)().text(e.chordBoxOptions.tunings[n]).attr({"font-size":16,"font-family":u}).fill("#000").cx(r/2).cy(25);return i.add(s),i.add(a),s.back(),a.front(),i.move(n*r,0),i}));return t.add(n),i.map((function(e){t.add(e)})),n.back(),t.move(55,55),t}},{key:"generateChordboxBody",value:function(){var e=(0,o.SVG)().group(),t=(0,o.SVG)().rect(225,240).fill("#fff");return e.add(t),e.move(55,105),e}},{key:"generatechordBoxNut",value:function(){var e=(0,o.SVG)().group(),t=(0,o.SVG)().rect(195,y).fill("none").radius(3);return 1===this.chordBoxOptions.baseFret&&t.fill("#000"),e.add(t),e.move(70,105),e}},{key:"generatechordBoxFrets",value:function(){var e=(0,o.SVG)().group(),t=230/this.chordBoxOptions.frets,r=(0,o.SVG)().rect(195,230).fill("#fff"),n=Array.from(Array(this.chordBoxOptions.frets)).map((function(e,r){var n=(0,o.SVG)().rect(195,3).fill("#C0C0C0");return n.move(0,r*t),n}));return e.add(r),n.map((function(t){e.add(t)})),e.back(),e.move(70,115),e}},{key:"generateChordBoxStrings",value:function(){var e=this,t=(0,o.SVG)().group(),r=225/this.chordBoxOptions.tunings.length,n=(0,o.SVG)().rect(225,230).fill("none"),i=Array.from(Array(this.chordBoxOptions.tunings.length)).map((function(t,n){var i=.125*e.chordBoxOptions.guages[n],s=(0,o.SVG)().rect(i,230).fill("#E48C5D");return s.move(n*r+r/2,0),s}));return t.add(n),i.map((function(e){t.add(e)})),t.back(),t.move(55,115),t}},{key:"generateChordBoxDots",value:function(){var e=this,t=(0,o.SVG)().group(),r=225/this.chordBoxOptions.tunings.length,n=230/this.chordBoxOptions.frets,i=this.chordBoxOptions.tunings.length,s=this.chordBoxOptions.guages,a=this.chordBoxOptions.dots,d=(0,o.SVG)().rect(225,230).fill("none"),f=Array.from(a).map((function(t){var a=(0,o.SVG)().group(),d=(0,o.SVG)().circle(30).fill("#000");d.cx((i-t.string)*r+r/2+.125*s[i-t.string]/2).cy((t.fret-1)*n+n/2),1===t.fret&&d.cy(n/2+y/(2*e.chordBoxOptions.frets));var f=(0,o.SVG)().text(e.chordBoxOptions.dotText(t)).attr({"font-size":12,"font-family":u}).fill("#fff");return f.cx((i-t.string)*r+r/2+.125*s[i-t.string]/2).cy((t.fret-1)*n+n/2),1===t.fret&&f.cy(n/2+y/(2*e.chordBoxOptions.frets)),a.add(d),a.add(f),d.back(),f.front(),a}));return t.add(d),f.map((function(e){t.add(e)})),t.back(),t.move(55,115),t}},{key:"setFontsDir",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,r.resolve)(__dirname,"./assets/fonts");return n.config.setFontDir(e),this}},{key:"setDots",value:function(e){return this.chordBoxOptions.dots=e,this.render(),this}},{key:"render",value:function(){return this.renderer.clear(),this.renderer.add(this.generateChordBoxBase()),this.renderer.add(this.generateChordBoxTitle()),this.renderer.add(this.generatechordBoxFretLabels()),this.renderer.add(this.generatechordBoxStringLabels()),this.renderer.add(this.generateChordboxBody()),this.renderer.add(this.generatechordBoxNut()),this.renderer.add(this.generatechordBoxFrets()),this.renderer.add(this.generateChordBoxStrings()),this.renderer.add(this.generateChordBoxDots()),this.renderer.attr({width:l,height:g}),this}},{key:"toSVG",value:function(){return this.renderer.svg()}},{key:"toSVGBase64URI",value:function(){return"data:image/svg+xml;base64,".concat(Buffer.from(this.renderer.svg()).toString("base64"))}}],i&&a(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()};return t.default})()));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hvcmRib3gudW1kLmpzIiwibWFwcGluZ3MiOiJDQUFBLFNBQTJDQSxFQUFNQyxHQUMxQixpQkFBWkMsU0FBMEMsaUJBQVhDLE9BQ3hDQSxPQUFPRCxRQUFVRCxJQUNRLG1CQUFYRyxRQUF5QkEsT0FBT0MsSUFDOUNELE9BQU8sR0FBSUgsR0FDZSxpQkFBWkMsUUFDZEEsUUFBa0IsU0FBSUQsSUFFdEJELEVBQWUsU0FBSUMsR0FDcEIsQ0FURCxDQVNHSyxRQUFRLEksbUJDUlgsSUFBSUMsRUFBc0IsQ0NBMUJBLEVBQXdCLENBQUNMLEVBQVNNLEtBQ2pDLElBQUksSUFBSUMsS0FBT0QsRUFDWEQsRUFBb0JHLEVBQUVGLEVBQVlDLEtBQVNGLEVBQW9CRyxFQUFFUixFQUFTTyxJQUM1RUUsT0FBT0MsZUFBZVYsRUFBU08sRUFBSyxDQUFFSSxZQUFZLEVBQU1DLElBQUtOLEVBQVdDLElBRTFFLEVDTkRGLEVBQXdCLENBQUNRLEVBQUtDLElBQVVMLE9BQU9NLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLEksNEJDQWxGLE1BQU0sRUFBK0JJLFFBQVEsUUNBdkMsRUFBK0JBLFFBQVEsb0JDQXZDLEVBQStCQSxRQUFRLFUsNjFCQ0s3Q0MsRUFBQUEsT0FBQUEsWUFDY0MsRUFBQUEsRUFBQUEsU0FBUUMsVUFBVyxpQkFDOUJDLHNCQUFzQixDQUNyQixhQUFjLGVBR2xCLElBQU1DLEdBQVNDLEVBQUFBLEVBQUFBLG1CQUNUQyxFQUFXRixFQUFPRSxVQUN4QkMsRUFBQUEsRUFBQUEsZ0JBQWVILEVBQVFFLEdBVXZCLElBQU1FLEVBQTBCLENBQzlCQyxNQUFPLFFBQ1BDLE1BQU8sRUFDUEMsU0FBVSxFQUNWQyxLQUFNLEdBQ05DLFFBQVMsaUJBQU0sRUFBTixFQUNUQyxRQUFTLENBQUMsSUFBSyxJQUFLLElBQUssSUFBSyxJQUFLLEtBQ25DQyxPQUFRLENBQUMsR0FBSSxHQUFJLEdBQUksR0FBSSxHQUFJLEtBR3pCQyxFQUVRLFFBRlJBLEVBS0csSUFMSEEsRUFNSSxJQU5KQSxFQWNTLEdBZFRBLEVBbUJhLEdBbkJiQSxFQTBCZ0IsR0ExQmhCQSxFQW9DTyxHQXlnQmIsU0FBaUJDLFNBMWZYQSxXQU1KLFdBQWFDLEdBV1gsTyw0RkFYNkMsa0NBRkpWLEdBR3pDVyxLQUFLQyxVQUFXQyxFQUFBQSxFQUFBQSxPQUdoQkYsS0FBS0QsZ0JBQUwsT0FDS0MsS0FBS0QsaUJBQ0xBLEdBR0xDLEtBQUtHLDBCQUVFSCxJQUNSLEMsMkRBRUQsV0FDRSxHQUFJQSxLQUFLRCxnQkFBZ0JSLE1BQVEsR0FBS1MsS0FBS0QsZ0JBQWdCUixNQUFRLEVBQ2pFLE1BQU0sSUFBSWEsTUFBTSxpQ0FHbEIsR0FBSUosS0FBS0QsZ0JBQWdCUCxTQUFXLEdBQUtRLEtBQUtELGdCQUFnQlAsU0FBVyxHQUN2RSxNQUFNLElBQUlZLE1BQU0scUNBR2xCLEdBQTRDLElBQXhDSixLQUFLRCxnQkFBZ0JKLFFBQVFVLE9BQy9CLE1BQU0sSUFBSUQsTUFBTSwwQ0FHbEIsR0FBMkMsSUFBdkNKLEtBQUtELGdCQUFnQkgsT0FBT1MsT0FDOUIsTUFBTSxJQUFJRCxNQUFNLHlDQUVuQixHLGtDQUVELFdBQ0UsSUFBTUUsR0FBb0JKLEVBQUFBLEVBQUFBLE9BQU1LLFFBRTFCQyxHQUF3Qk4sRUFBQUEsRUFBQUEsT0FDM0JPLEtBQ0NaLEVBQ0FBLEdBQ0RhLE9BeEZHLEdBeUZIQyxLQXhGWSxRQTBGVEMsR0FBZ0JWLEVBQUFBLEVBQUFBLE9BQ25CTyxLQUNDWixJQUNBQSxLQUNEYyxLQTdGTSxRQTBHVCxPQVhBTCxFQUFrQk8sSUFBSUwsR0FDdEJGLEVBQWtCTyxJQUFJRCxHQUV0QkosRUFBc0JNLE9BQ3RCRixFQUFhRyxRQUViSCxFQUFhSSxLQXhHTixLQTZHQVYsQ0FDUixHLG1DQUVELFdBQ0UsSUFBTVcsR0FBcUJmLEVBQUFBLEVBQUFBLE9BQU1LLFFBRTNCVyxHQUF5QmhCLEVBQUFBLEVBQUFBLE9BQzVCTyxLQTlHTyxJQWdITlosR0FFRGMsS0FoSFcsUUFrSFJRLEdBQWdCakIsRUFBQUEsRUFBQUEsT0FDbkJrQixLQUFLcEIsS0FBS0QsZ0JBQWdCVCxPQUMxQitCLEtBQUssQ0FDSixZQXBIUyxHQXFIVCxjQUFleEIsSUFFaEJjLEtBdEhXLFFBdUhYVyxHQUFHekIsT0FDSDBCLEdBQUcxQixJQWFOLE9BWEFvQixFQUFtQkosSUFBSUssR0FDdkJELEVBQW1CSixJQUFJTSxHQUV2QkQsRUFBdUJKLE9BQ3ZCSyxFQUFjSixRQUVkRSxFQUFtQkQsS0ExSVosS0ErSUFDLENBQ1IsRyx3Q0FFRCxXQUFzQyxXQUM5Qk8sR0FBMEJ0QixFQUFBQSxFQUFBQSxPQUFNSyxRQUdoQ2tCLEVBRG1CNUIsSUFDZ0JHLEtBQUtELGdCQUFnQlIsTUFFeERtQyxHQUE4QnhCLEVBQUFBLEVBQUFBLE9BQ2pDTyxLQUNDWixFQUxxQkEsS0FRdEJjLEtBaEp5QixRQWtKdEJnQixFQUEwQkMsTUFDN0JDLEtBQUtELE1BQU01QixLQUFLRCxnQkFBZ0JSLFFBQ2hDdUMsS0FBSSxTQUFDQyxFQUFHQyxHQUNQLElBQU1DLEdBQXdCL0IsRUFBQUEsRUFBQUEsT0FBTUssUUFFOUIyQixHQUE2QmhDLEVBQUFBLEVBQUFBLE9BQ2hDTyxLQUNDWixFQUNBNEIsR0FFRGQsS0ExSm9CLFFBNEpqQndCLEdBQXdCakMsRUFBQUEsRUFBQUEsT0FDM0JrQixNQUFNLEVBQUtyQixnQkFBZ0JQLFNBQVd3QyxHQUFnQkksWUFDdERmLEtBQUssQ0FDSixZQTlKUyxHQStKVCxjQUFleEIsSUFFaEJjLEtBaEtXLFFBaUtYVyxHQUFHekIsSUFDSDBCLEdBQUdFLEVBQWdCLEdBYXRCLE9BWEFRLEVBQXVCcEIsSUFBSXFCLEdBQzNCRCxFQUF1QnBCLElBQUlzQixHQUUzQkQsRUFBMkJwQixPQUMzQnFCLEVBQXNCcEIsUUFFdEJrQixFQUF1QmpCLEtBQ3JCLEVBQ0FnQixFQUFlUCxHQUdWUSxDQUNSLElBZ0JILE9BZEFULEVBQXdCWCxJQUFJYSxHQUU1QkMsRUFDR0csS0FBSSxTQUFBTyxHQUNIYixFQUF3QlgsSUFBSXdCLEVBQzdCLElBRUhYLEVBQTRCWixPQUU1QlUsRUFBd0JSLEtBNU1qQixFQThNTG5CLEtBR0syQixDQUNSLEcsMENBRUQsV0FBd0MsV0FDaENjLEdBQTRCcEMsRUFBQUEsRUFBQUEsT0FBTUssUUFHbENnQyxFQURvQjFDLElBQ2lCRyxLQUFLRCxnQkFBZ0JKLFFBQVFVLE9BRWxFbUMsR0FBZ0N0QyxFQUFBQSxFQUFBQSxPQUNuQ08sS0FKdUJaLElBTXRCQSxHQUVEYyxLQTNNMkIsUUE2TXhCOEIsRUFBNEJiLE1BQy9CQyxLQUFLRCxNQUFNNUIsS0FBS0QsZ0JBQWdCSixRQUFRVSxTQUN4Q3lCLEtBQUksU0FBQ0MsRUFBR1csR0FDUCxJQUFNQyxHQUEwQnpDLEVBQUFBLEVBQUFBLE9BQU1LLFFBRWhDcUMsR0FBK0IxQyxFQUFBQSxFQUFBQSxPQUNsQ08sS0FDQzhCLEVBQ0ExQyxHQUVEYyxLQXJOc0IsUUF1Tm5Ca0MsR0FBMEIzQyxFQUFBQSxFQUFBQSxPQUM3QmtCLEtBQUssRUFBS3JCLGdCQUFnQkosUUFBUStDLElBQ2xDckIsS0FBSyxDQUNKLFlBek5XLEdBME5YLGNBQWV4QixJQUVoQmMsS0EzTmEsUUE0TmJXLEdBQUdpQixFQUFpQixHQUNwQmhCLEdBQUcxQixJQWFOLE9BWEE4QyxFQUF5QjlCLElBQUkrQixHQUM3QkQsRUFBeUI5QixJQUFJZ0MsR0FFN0JELEVBQTZCOUIsT0FDN0IrQixFQUF3QjlCLFFBRXhCNEIsRUFBeUIzQixLQUN2QjBCLEVBQWlCSCxFQUNqQixHQUdLSSxDQUNSLElBZ0JILE9BZEFMLEVBQTBCekIsSUFBSTJCLEdBRTlCQyxFQUNHWCxLQUFJLFNBQUFnQixHQUNIUixFQUEwQnpCLElBQUlpQyxFQUMvQixJQUVITixFQUE4QjFCLE9BRTlCd0IsRUFBMEJ0QixLQUN4Qm5CLEdBQ0FBLElBR0t5QyxDQUNSLEcsa0NBRUQsV0FDRSxJQUFNUyxHQUFvQjdDLEVBQUFBLEVBQUFBLE9BQU1LLFFBRTFCeUMsR0FBZTlDLEVBQUFBLEVBQUFBLE9BQ2xCTyxLQUNDWixJQUNBQSxLQUVEYyxLQXBRVSxRQTZRYixPQVBBb0MsRUFBa0JsQyxJQUFJbUMsR0FFdEJELEVBQWtCL0IsS0FDaEJuQixHQUNBQSxLQUdLa0QsQ0FDUixHLGlDQUVELFdBQ0UsSUFBTUUsR0FBbUIvQyxFQUFBQSxFQUFBQSxPQUFNSyxRQUV6QjJDLEdBQXVCaEQsRUFBQUEsRUFBQUEsT0FDMUJPLEtBQ0VaLElBQ0RBLEdBRURjLEtBQUssUUFDTEQsT0FyUk0sR0FtU1QsT0FYc0MsSUFBbENWLEtBQUtELGdCQUFnQlAsVUFDdkIwRCxFQUFxQnZDLEtBeFJYLFFBMlJac0MsRUFBaUJwQyxJQUFJcUMsR0FFckJELEVBQWlCakMsS0FDZm5CLEdBQ0FBLEtBR0tvRCxDQUNSLEcsbUNBRUQsV0FDRSxJQUFNRSxHQUFxQmpELEVBQUFBLEVBQUFBLE9BQU1LLFFBSTNCNkMsRUFEY3ZELElBQ1dHLEtBQUtELGdCQUFnQlIsTUFFOUM4RCxHQUF5Qm5ELEVBQUFBLEVBQUFBLE9BQzVCTyxLQUxpQlosSUFDQUEsS0FPaEJjLEtBOVNtQixRQWdUakIyQyxFQUFzQjFCLE1BQ3pCQyxLQUFLRCxNQUFNNUIsS0FBS0QsZ0JBQWdCUixRQUNoQ3VDLEtBQUksU0FBQ0MsRUFBR3dCLEdBQ1AsSUFBTUMsR0FBYXRELEVBQUFBLEVBQUFBLE9BQ2hCTyxLQWRhWixJQXBTSixHQXNUVGMsS0FyVFksV0E0VGYsT0FMQTZDLEVBQVd4QyxLQUNULEVBQ0F1QyxFQUFnQkgsR0FHWEksQ0FDUixJQWVILE9BYkFMLEVBQW1CdEMsSUFBSXdDLEdBRXZCQyxFQUFvQnhCLEtBQUksU0FBQTBCLEdBQ3RCTCxFQUFtQnRDLElBQUkyQyxFQUN4QixJQUVETCxFQUFtQnJDLE9BRW5CcUMsRUFBbUJuQyxLQUNqQm5CLEdBQ0FBLEtBR0tzRCxDQUNSLEcscUNBRUQsV0FBbUMsV0FDM0JNLEdBQXVCdkQsRUFBQUEsRUFBQUEsT0FBTUssUUFJN0JtRCxFQUZlN0QsSUFFWUcsS0FBS0QsZ0JBQWdCSixRQUFRVSxPQUd4RHNELEdBQTJCekQsRUFBQUEsRUFBQUEsT0FDOUJPLEtBTmtCWixJQUNDQSxLQVFsQmMsS0FBSyxRQUVIaUQsRUFBa0JoQyxNQUNyQkMsS0FBS0QsTUFBTTVCLEtBQUtELGdCQUFnQkosUUFBUVUsU0FDeEN5QixLQUFJLFNBQUNDLEVBQUc4QixHQUNQLElBQU1DLEVBWHFCLEtBV1AsRUFBSy9ELGdCQUFnQkgsT0FBT2lFLEdBRTFDRSxHQUFTN0QsRUFBQUEsRUFBQUEsT0FDWk8sS0FBS3FELEVBaEJVakUsS0FpQmZjLEtBbFdRLFdBeVdYLE9BTEFvRCxFQUFPL0MsS0FDTDZDLEVBQVlILEVBQWNBLEVBQVksRUFDdEMsR0FHS0ssQ0FDUixJQWVILE9BYkFOLEVBQXFCNUMsSUFBSThDLEdBRXpCQyxFQUFnQjlCLEtBQUksU0FBQWlDLEdBQ2xCTixFQUFxQjVDLElBQUlrRCxFQUMxQixJQUVETixFQUFxQjNDLE9BRXJCMkMsRUFBcUJ6QyxLQUNuQm5CLEdBQ0FBLEtBR0s0RCxDQUNSLEcsa0NBRUQsV0FBZ0MsV0FDeEJPLEdBQW9COUQsRUFBQUEsRUFBQUEsT0FBTUssUUFJMUIwRCxFQUZZcEUsSUFFU0csS0FBS0QsZ0JBQWdCSixRQUFRVSxPQUNsRDZELEVBRmFyRSxJQUVVRyxLQUFLRCxnQkFBZ0JSLE1BRTVDNEUsRUFBVW5FLEtBQUtELGdCQUFnQkosUUFBUVUsT0FDdkNULEVBQVNJLEtBQUtELGdCQUFnQkgsT0FHOUJ3RSxFQUFjcEUsS0FBS0QsZ0JBQWdCTixLQUVuQzRFLEdBQXdCbkUsRUFBQUEsRUFBQUEsT0FDM0JPLEtBWmVaLElBQ0NBLEtBY2ZjLEtBQUssUUFFSDJELEVBQWUxQyxNQUNsQkMsS0FBS3VDLEdBQ0x0QyxLQUFJLFNBQUF5QyxHQUNILElBQU1DLEdBQVd0RSxFQUFBQSxFQUFBQSxPQUFNSyxRQUVqQmtFLEdBQWV2RSxFQUFBQSxFQUFBQSxPQUNsQndFLE9BcFpBLElBcVpBL0QsS0FuWkssUUFxWlI4RCxFQUNHbkQsSUFBSzZDLEVBQVVJLEVBQUlSLFFBQVVFLEVBQVdBLEVBQVMsRUFwQnpCLEtBb0IrQnJFLEVBQU91RSxFQUFVSSxFQUFJUixRQUFvQyxHQUNoSHhDLElBQUlnRCxFQUFJSSxLQUFLLEdBQUtULEVBQVlBLEVBQVUsR0FHMUIsSUFBYkssRUFBSUksTUFDTkYsRUFBYWxELEdBQUcyQyxFQUFVLEVBQUlyRSxHQUE2QixFQUFFLEVBQUtFLGdCQUFnQlIsUUFHcEYsSUFBTUcsR0FBVVEsRUFBQUEsRUFBQUEsT0FDYmtCLEtBQUssRUFBS3JCLGdCQUFnQkwsUUFBUTZFLElBQ2xDbEQsS0FBSyxDQUNKLFlBbGFHLEdBbWFILGNBQWV4QixJQUVoQmMsS0FBSyxRQWlCUixPQWZBakIsRUFDRzRCLElBQUs2QyxFQUFVSSxFQUFJUixRQUFVRSxFQUFXQSxFQUFTLEVBckN6QixLQXFDK0JyRSxFQUFPdUUsRUFBVUksRUFBSVIsUUFBb0MsR0FDaEh4QyxJQUFJZ0QsRUFBSUksS0FBSyxHQUFLVCxFQUFZQSxFQUFVLEdBRzFCLElBQWJLLEVBQUlJLE1BQ05qRixFQUFRNkIsR0FBRzJDLEVBQVUsRUFBSXJFLEdBQTZCLEVBQUUsRUFBS0UsZ0JBQWdCUixRQUcvRWlGLEVBQVMzRCxJQUFJNEQsR0FDYkQsRUFBUzNELElBQUluQixHQUViK0UsRUFBYTNELE9BQ2JwQixFQUFRcUIsUUFFRHlELENBQ1IsSUFlSCxPQWJBUixFQUFrQm5ELElBQUl3RCxHQUV0QkMsRUFBYXhDLEtBQUksU0FBQXlDLEdBQ2ZQLEVBQWtCbkQsSUFBSTBELEVBQ3ZCLElBRURQLEVBQWtCbEQsT0FFbEJrRCxFQUFrQmhELEtBQ2hCbkIsR0FDQUEsS0FHS21FLENBQ1IsRyx5QkFFRCxXQUFzRSxJQUF6RFksRUFBeUQsd0RBQXRDOUYsRUFBQUEsRUFBQUEsU0FBUUMsVUFBVyxrQkFJakQsT0FGQUYsRUFBQUEsT0FBQUEsV0FBa0IrRixHQUVYNUUsSUFDUixHLHFCQUVELFNBQVNQLEdBS1AsT0FKQU8sS0FBS0QsZ0JBQWdCTixLQUFPQSxFQUU1Qk8sS0FBSzZFLFNBRUU3RSxJQUNSLEcsb0JBRUQsV0F5QkUsT0F2QkFBLEtBQUtDLFNBQVM2RSxRQUdkOUUsS0FBS0MsU0FBU1ksSUFBSWIsS0FBSytFLHdCQUN2Qi9FLEtBQUtDLFNBQVNZLElBQUliLEtBQUtnRix5QkFFdkJoRixLQUFLQyxTQUFTWSxJQUFJYixLQUFLaUYsOEJBQ3ZCakYsS0FBS0MsU0FBU1ksSUFBSWIsS0FBS2tGLGdDQUd2QmxGLEtBQUtDLFNBQVNZLElBQUliLEtBQUttRix3QkFDdkJuRixLQUFLQyxTQUFTWSxJQUFJYixLQUFLb0YsdUJBQ3ZCcEYsS0FBS0MsU0FBU1ksSUFBSWIsS0FBS3FGLHlCQUN2QnJGLEtBQUtDLFNBQVNZLElBQUliLEtBQUtzRiwyQkFDdkJ0RixLQUFLQyxTQUFTWSxJQUFJYixLQUFLdUYsd0JBR3ZCdkYsS0FBS0MsU0FDRm9CLEtBQUssQ0FDSm1FLE1BQU8zRixFQUNQNEYsT0FBUTVGLElBR0xHLElBQ1IsRyxtQkFFRCxXQUNFLE9BQU9BLEtBQUtDLFNBQVN5RixLQUN0QixHLDRCQUVELFdBQ0UsTUFBTyw2QkFBUCxPQUFvQ0MsT0FBTzlELEtBQUs3QixLQUFLQyxTQUFTeUYsT0FBT3RELFNBQVMsVUFDL0UsSSx5RUF2Zkd0QyxJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2hvcmRib3gvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2Nob3JkYm94L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2Nob3JkYm94L3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9jaG9yZGJveC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL2Nob3JkYm94L2V4dGVybmFsIG5vZGUtY29tbW9uanMgXCJwYXRoXCIiLCJ3ZWJwYWNrOi8vY2hvcmRib3gvZXh0ZXJuYWwgY29tbW9uanMgXCJAc3ZnZG90anMvc3ZnLmpzXCIiLCJ3ZWJwYWNrOi8vY2hvcmRib3gvZXh0ZXJuYWwgY29tbW9uanMgXCJzdmdkb21cIiIsIndlYnBhY2s6Ly9jaG9yZGJveC8uL3NyYy9jaG9yZGJveC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiY2hvcmRib3hcIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1wiY2hvcmRib3hcIl0gPSBmYWN0b3J5KCk7XG59KShnbG9iYWwsICgpID0+IHtcbnJldHVybiAiLCIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwicGF0aFwiKTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcIkBzdmdkb3Rqcy9zdmcuanNcIik7IiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJzdmdkb21cIik7IiwiaW1wb3J0IHsgcmVzb2x2ZSB9IGZyb20gJ3BhdGgnXG5pbXBvcnQgeyBTVkcsIHJlZ2lzdGVyV2luZG93IH0gZnJvbSBcIkBzdmdkb3Rqcy9zdmcuanNcIlxuaW1wb3J0IHsgY29uZmlnLCBjcmVhdGVTVkdXaW5kb3cgfSBmcm9tIFwic3ZnZG9tXCJcblxuLyogZXNsaW50LWRpc2FibGUgKi9cbmNvbmZpZ1xuICAuc2V0Rm9udERpcihyZXNvbHZlKF9fZGlybmFtZSwgJ2Fzc2V0cy9mb250cycpKVxuICAuc2V0Rm9udEZhbWlseU1hcHBpbmdzKHtcbiAgICAnc2Fucy1zZXJpZic6ICduYWhuYWgudHRmJ1xuICB9KVxuXG5jb25zdCB3aW5kb3cgPSBjcmVhdGVTVkdXaW5kb3coKVxuY29uc3QgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnRcbnJlZ2lzdGVyV2luZG93KHdpbmRvdywgZG9jdW1lbnQpXG4vKiBlc2xpbnQtZW5hYmxlICovXG5cbmltcG9ydCB7XG4gIENob3JkQm94UmVuZGVyZXIsXG4gIENob3JkQm94T3B0aW9ucyxcbiAgQ2hvcmRCb3hEb3Rcbn0gZnJvbSAnLi90eXBlcydcblxuLy8gdGhlIHRoaW5ncyBhIHVzZXIgY2FuIGNvbmZpZ3VyZVxuY29uc3QgQ2hvcmRCb3hPcHRpb25zRGVmYXVsdHMgPSB7XG4gIHRpdGxlOiAnQ2hvcmQnLFxuICBmcmV0czogMyxcbiAgYmFzZUZyZXQ6IDEsXG4gIGRvdHM6IFtdIGFzIENob3JkQm94RG90W10sXG4gIGRvdFRleHQ6ICgpID0+ICcnLFxuICB0dW5pbmdzOiBbJ0UnLCAnQScsICdEJywgJ0cnLCAnQicsICdFJ10sXG4gIGd1YWdlczogWzQ2LCAzNiwgMjUsIDE3LCAxMywgMTBdLFxufVxuXG5jb25zdCBDSE9SREJPWF9TRVRUSU5HUyA9IHtcbiAgLy8gdHlwb2dyYXBoeVxuICBmb250RmFtaWx5OiAnQXJpYWwnLFxuXG4gIC8vIGJhc2VcbiAgd2lkdGg6IDI4NSxcbiAgaGVpZ2h0OiAzNTAsXG4gIHBhZGRpbmc6IDUsXG4gIHJhZGl1czogNSxcbiAgYm9yZGVyRmlsbENvbG9yOiAnIzAwMCcsXG4gIGZpbGxDb2xvcjogJyNmZmYnLFxuXG4gIC8vIHRpdGxlXG4gIHRpdGxlV2lkdGg6IDI3NSxcbiAgdGl0bGVIZWlnaHQ6IDUwLFxuICB0aXRsZUZpbGxDb2xvcjogJyMwMDAnLFxuICB0aXRsZUZvbnRTaXplOiAyNCxcbiAgdGl0bGVGb250Q29sb3I6ICcjZmZmJyxcblxuICBmcmV0TGFiZWxzV2lkdGg6IDUwLFxuICBmcmV0TGFiZWxzQ29udGFpbmVyRmlsbENvbG9yOiAnI2ZmZicsXG5cbiAgZnJldExhYmVsQ29udGFpbmVyRmlsbENvbG9yOiAnI2ZmZicsXG4gIGZyZXRMYWJlbEZvbnRTaXplOiAxNixcbiAgZnJldExhYmVsRm9udENvbG9yOiAnIzAwMCcsXG5cbiAgc3RyaW5nTGFiZWxzSGVpZ2h0OiA1MCxcbiAgc3RyaW5nTGFiZWxzQ29udGFpbmVyRmlsbENvbG9yOiAnI2ZmZicsXG5cbiAgc3RyaW5nTGFiZWxDb250YWluZXJGaWxsQ29sb3I6ICcjZmZmJyxcbiAgc3RyaW5nTGFiZWxGb250U2l6ZTogMTYsXG4gIHN0cmluZ0xhYmVsRm9udENvbG9yOiAnIzAwMCcsXG5cbiAgYm9keUZpbGxDb2xvcjogJyNmZmYnLFxuXG4gIG51dENvbnRhaW5lclBhZGRpbmc6IDE1LFxuICBudXRIZWlnaHQ6IDEwLFxuICBudXRSYWRpdXM6IDMsXG4gIG51dEZpbGxDb2xvcjogJyMwMDAnLFxuXG4gIGZyZXRzQ29udGFpbmVyRmlsbENvbG9yOiAnI2ZmZicsXG4gIFxuICBmcmV0TWFya2VySGVpZ2h0OiAzLFxuICBmcmV0TWFya2VyRmlsbENvbG9yOiAnI0MwQzBDMCcsXG5cbiAgc3RyaW5nRmlsbENvbG9yOiAnI0U0OEM1RCcsXG5cbiAgZG90U2l6ZTogMzAsXG4gIGRvdEZvbnRTaXplOiAxMixcbiAgZG90RmlsbENvbG9yOiAnIzAwMCdcbn1cbmNsYXNzIENob3JkQm94IHtcblxuICBwcml2YXRlIHJlbmRlcmVyOiBDaG9yZEJveFJlbmRlcmVyXG5cbiAgcHJpdmF0ZSBjaG9yZEJveE9wdGlvbnM6IENob3JkQm94T3B0aW9ucyA9IENob3JkQm94T3B0aW9uc0RlZmF1bHRzXG5cbiAgY29uc3RydWN0b3IgKGNob3JkQm94T3B0aW9uczogQ2hvcmRCb3hPcHRpb25zKSB7XG4gICAgdGhpcy5yZW5kZXJlciA9IFNWRygpXG5cbiAgICAvLyBhc3NpZ24gb3B0aW9uc1xuICAgIHRoaXMuY2hvcmRCb3hPcHRpb25zID0ge1xuICAgICAgLi4udGhpcy5jaG9yZEJveE9wdGlvbnMsXG4gICAgICAuLi5jaG9yZEJveE9wdGlvbnNcbiAgICB9XG5cbiAgICB0aGlzLnZhbGlkYXRlQ2hvcmRCb3hPcHRpb25zKClcblxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlQ2hvcmRCb3hPcHRpb25zICgpIHtcbiAgICBpZiAodGhpcy5jaG9yZEJveE9wdGlvbnMuZnJldHMgPCAxIHx8IHRoaXMuY2hvcmRCb3hPcHRpb25zLmZyZXRzID4gNikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdmcmV0cyBtdXN0IGJlIGJldHdlZW4gMSBhbmQgNicpXG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2hvcmRCb3hPcHRpb25zLmJhc2VGcmV0IDwgMSB8fCB0aGlzLmNob3JkQm94T3B0aW9ucy5iYXNlRnJldCA+IDI0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Jhc2VGcmV0IG11c3QgYmUgYmV0d2VlbiAxIGFuZCAyNCcpXG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2hvcmRCb3hPcHRpb25zLnR1bmluZ3MubGVuZ3RoICE9PSA2KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3R1bmluZyBtdXN0IHByZXNlbnQgZm9yIDYgc3RyaW5ncyBvbmx5JylcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jaG9yZEJveE9wdGlvbnMuZ3VhZ2VzLmxlbmd0aCAhPT0gNikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdndWFnZXMgbXVzdCBwcmVzZW50IGZvciA2IHN0cmluZ3Mgb25seScpXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNob3JkQm94QmFzZSAoKSB7XG4gICAgY29uc3QgY2hvcmRCb3hCYXNlR3JvdXAgPSBTVkcoKS5ncm91cCgpXG5cbiAgICBjb25zdCBjaG9yZEJveEJhc2VDb250YWluZXIgPSBTVkcoKVxuICAgICAgLnJlY3QoXG4gICAgICAgIENIT1JEQk9YX1NFVFRJTkdTLndpZHRoLFxuICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy5oZWlnaHQpXG4gICAgICAucmFkaXVzKENIT1JEQk9YX1NFVFRJTkdTLnJhZGl1cylcbiAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLmJvcmRlckZpbGxDb2xvcilcblxuICAgIGNvbnN0IGNob3JkQm94QmFzZSA9ICBTVkcoKVxuICAgICAgLnJlY3QoXG4gICAgICAgIENIT1JEQk9YX1NFVFRJTkdTLndpZHRoLSgyKkNIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcpLFxuICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy5oZWlnaHQtKDIqQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZykpXG4gICAgICAuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5maWxsQ29sb3IpXG5cbiAgICBjaG9yZEJveEJhc2VHcm91cC5hZGQoY2hvcmRCb3hCYXNlQ29udGFpbmVyKVxuICAgIGNob3JkQm94QmFzZUdyb3VwLmFkZChjaG9yZEJveEJhc2UpXG5cbiAgICBjaG9yZEJveEJhc2VDb250YWluZXIuYmFjaygpXG4gICAgY2hvcmRCb3hCYXNlLmZyb250KClcblxuICAgIGNob3JkQm94QmFzZS5tb3ZlKFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyxcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmdcbiAgICApXG5cbiAgICByZXR1cm4gY2hvcmRCb3hCYXNlR3JvdXBcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVDaG9yZEJveFRpdGxlICgpIHtcbiAgICBjb25zdCBjaG9yZEJveFRpdGxlR3JvdXAgPSBTVkcoKS5ncm91cCgpXG5cbiAgICBjb25zdCBjaG9yZEJveFRpdGxlQ29udGFpbmVyID0gU1ZHKClcbiAgICAgIC5yZWN0KFxuICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy50aXRsZVdpZHRoLFxuICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodFxuICAgICAgKVxuICAgICAgLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVGaWxsQ29sb3IpXG5cbiAgICBjb25zdCBDaG9yZEJveFRpdGxlID0gU1ZHKClcbiAgICAgIC50ZXh0KHRoaXMuY2hvcmRCb3hPcHRpb25zLnRpdGxlKVxuICAgICAgLmF0dHIoe1xuICAgICAgICAnZm9udC1zaXplJzogQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVGb250U2l6ZSxcbiAgICAgICAgJ2ZvbnQtZmFtaWx5JzogQ0hPUkRCT1hfU0VUVElOR1MuZm9udEZhbWlseVxuICAgICAgfSlcbiAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLnRpdGxlRm9udENvbG9yKVxuICAgICAgLmN4KENIT1JEQk9YX1NFVFRJTkdTLnRpdGxlV2lkdGgvMilcbiAgICAgIC5jeShDSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodC8yKVxuXG4gICAgY2hvcmRCb3hUaXRsZUdyb3VwLmFkZChjaG9yZEJveFRpdGxlQ29udGFpbmVyKVxuICAgIGNob3JkQm94VGl0bGVHcm91cC5hZGQoQ2hvcmRCb3hUaXRsZSlcblxuICAgIGNob3JkQm94VGl0bGVDb250YWluZXIuYmFjaygpXG4gICAgQ2hvcmRCb3hUaXRsZS5mcm9udCgpXG5cbiAgICBjaG9yZEJveFRpdGxlR3JvdXAubW92ZShcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcsXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nXG4gICAgKVxuXG4gICAgcmV0dXJuIGNob3JkQm94VGl0bGVHcm91cFxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZWNob3JkQm94RnJldExhYmVscyAoKSB7XG4gICAgY29uc3QgY2hvcmRCb3hGcmV0TGFiZWxzR3JvdXAgPSBTVkcoKS5ncm91cCgpXG5cbiAgICBjb25zdCBmcmV0TGFiZWxzSGVpZ2h0ID0gQ0hPUkRCT1hfU0VUVElOR1MuaGVpZ2h0LSgyKkNIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcpLUNIT1JEQk9YX1NFVFRJTkdTLnRpdGxlSGVpZ2h0LUNIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsc0hlaWdodFxuICAgIGNvbnN0IGZyZXRMYWJlbEhlaWdodCA9IGZyZXRMYWJlbHNIZWlnaHQvdGhpcy5jaG9yZEJveE9wdGlvbnMuZnJldHNcblxuICAgIGNvbnN0IGNob3JkQm94RnJldExhYmVsc0NvbnRhaW5lciA9IFNWRygpXG4gICAgICAucmVjdChcbiAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoLFxuICAgICAgICBmcmV0TGFiZWxzSGVpZ2h0XG4gICAgICApXG4gICAgICAuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzQ29udGFpbmVyRmlsbENvbG9yKVxuICAgIFxuICAgIGNvbnN0IGNob3JkQm94RnJldGJvYXJkTGFiZWxzID0gQXJyYXlcbiAgICAgIC5mcm9tKEFycmF5KHRoaXMuY2hvcmRCb3hPcHRpb25zLmZyZXRzKSlcbiAgICAgIC5tYXAoKF8sIGZyZXRMYWJlbEluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGNob3JkQm94RnJldExhYmVsR3JvdXA9IFNWRygpLmdyb3VwKClcblxuICAgICAgICBjb25zdCBjaG9yZEJveEZyZXRMYWJlbENvbnRhaW5lciA9IFNWRygpXG4gICAgICAgICAgLnJlY3QoXG4gICAgICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzV2lkdGgsXG4gICAgICAgICAgICBmcmV0TGFiZWxIZWlnaHRcbiAgICAgICAgICApXG4gICAgICAgICAgLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsQ29udGFpbmVyRmlsbENvbG9yKVxuXG4gICAgICAgIGNvbnN0IGNob3JkQm94RnJldExhYmVsVGV4dCA9IFNWRygpXG4gICAgICAgICAgLnRleHQoKHRoaXMuY2hvcmRCb3hPcHRpb25zLmJhc2VGcmV0ICsgZnJldExhYmVsSW5kZXgpLnRvU3RyaW5nKCkpXG4gICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgJ2ZvbnQtc2l6ZSc6IENIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbEZvbnRTaXplLFxuICAgICAgICAgICAgJ2ZvbnQtZmFtaWx5JzogQ0hPUkRCT1hfU0VUVElOR1MuZm9udEZhbWlseVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsRm9udENvbG9yKVxuICAgICAgICAgIC5jeChDSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzV2lkdGgvMilcbiAgICAgICAgICAuY3koZnJldExhYmVsSGVpZ2h0LzIpXG5cbiAgICAgICAgY2hvcmRCb3hGcmV0TGFiZWxHcm91cC5hZGQoY2hvcmRCb3hGcmV0TGFiZWxDb250YWluZXIpXG4gICAgICAgIGNob3JkQm94RnJldExhYmVsR3JvdXAuYWRkKGNob3JkQm94RnJldExhYmVsVGV4dClcblxuICAgICAgICBjaG9yZEJveEZyZXRMYWJlbENvbnRhaW5lci5iYWNrKClcbiAgICAgICAgY2hvcmRCb3hGcmV0TGFiZWxUZXh0LmZyb250KClcblxuICAgICAgICBjaG9yZEJveEZyZXRMYWJlbEdyb3VwLm1vdmUoXG4gICAgICAgICAgMCxcbiAgICAgICAgICBmcmV0TGFiZWxJbmRleCpmcmV0TGFiZWxIZWlnaHRcbiAgICAgICAgKVxuXG4gICAgICAgIHJldHVybiBjaG9yZEJveEZyZXRMYWJlbEdyb3VwXG4gICAgICB9KVxuXG4gICAgY2hvcmRCb3hGcmV0TGFiZWxzR3JvdXAuYWRkKGNob3JkQm94RnJldExhYmVsc0NvbnRhaW5lcilcblxuICAgIGNob3JkQm94RnJldGJvYXJkTGFiZWxzXG4gICAgICAubWFwKGNob3JkQm94RnJldExhYmVsID0+IHtcbiAgICAgICAgY2hvcmRCb3hGcmV0TGFiZWxzR3JvdXAuYWRkKGNob3JkQm94RnJldExhYmVsKVxuICAgICAgfSlcblxuICAgIGNob3JkQm94RnJldExhYmVsc0NvbnRhaW5lci5iYWNrKClcblxuICAgIGNob3JkQm94RnJldExhYmVsc0dyb3VwLm1vdmUoXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nLFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyArIENIT1JEQk9YX1NFVFRJTkdTLnRpdGxlSGVpZ2h0ICsgQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0XG4gICAgKVxuXG4gICAgcmV0dXJuIGNob3JkQm94RnJldExhYmVsc0dyb3VwXG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlY2hvcmRCb3hTdHJpbmdMYWJlbHMgKCkge1xuICAgIGNvbnN0IGNob3JkQm94U3RyaW5nTGFiZWxzR3JvdXAgPSBTVkcoKS5ncm91cCgpXG5cbiAgICBjb25zdCBzdHJpbmdMYWJlbHNXaWR0aCA9IENIT1JEQk9YX1NFVFRJTkdTLndpZHRoLSgyKkNIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcpLUNIT1JEQk9YX1NFVFRJTkdTLmZyZXRMYWJlbHNXaWR0aFxuICAgIGNvbnN0IHN0cmluZ0xhYmVsV2lkdGggPSBzdHJpbmdMYWJlbHNXaWR0aC90aGlzLmNob3JkQm94T3B0aW9ucy50dW5pbmdzLmxlbmd0aCAvLyBzdHJpbmcgY291bnRcblxuICAgIGNvbnN0IGNob3JkQm94U3RyaW5nTGFiZWxzQ29udGFpbmVyID0gU1ZHKClcbiAgICAgIC5yZWN0KFxuICAgICAgICBzdHJpbmdMYWJlbHNXaWR0aCxcbiAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0XG4gICAgICApXG4gICAgICAuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNDb250YWluZXJGaWxsQ29sb3IpXG4gICAgXG4gICAgY29uc3QgY2hvcmRCb3hTdHJpbmdib2FyZExhYmVscyA9IEFycmF5XG4gICAgICAuZnJvbShBcnJheSh0aGlzLmNob3JkQm94T3B0aW9ucy50dW5pbmdzLmxlbmd0aCAvKiBzdHJpbmcgY291bnQgKi8pKVxuICAgICAgLm1hcCgoXywgc3RyaW5nTGFiZWxJbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBjaG9yZEJveFN0cmluZ0xhYmVsR3JvdXA9IFNWRygpLmdyb3VwKClcblxuICAgICAgICBjb25zdCBjaG9yZEJveFN0cmluZ0xhYmVsQ29udGFpbmVyID0gU1ZHKClcbiAgICAgICAgICAucmVjdChcbiAgICAgICAgICAgIHN0cmluZ0xhYmVsV2lkdGgsXG4gICAgICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHRcbiAgICAgICAgICApXG4gICAgICAgICAgLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxDb250YWluZXJGaWxsQ29sb3IpXG5cbiAgICAgICAgY29uc3QgY2hvcmRCb3hTdHJpbmdMYWJlbFRleHQgPSBTVkcoKVxuICAgICAgICAgIC50ZXh0KHRoaXMuY2hvcmRCb3hPcHRpb25zLnR1bmluZ3Nbc3RyaW5nTGFiZWxJbmRleF0pXG4gICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgJ2ZvbnQtc2l6ZSc6IENIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsRm9udFNpemUsXG4gICAgICAgICAgICAnZm9udC1mYW1pbHknOiBDSE9SREJPWF9TRVRUSU5HUy5mb250RmFtaWx5XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbEZvbnRDb2xvcilcbiAgICAgICAgICAuY3goc3RyaW5nTGFiZWxXaWR0aC8yKVxuICAgICAgICAgIC5jeShDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHQvMilcblxuICAgICAgICBjaG9yZEJveFN0cmluZ0xhYmVsR3JvdXAuYWRkKGNob3JkQm94U3RyaW5nTGFiZWxDb250YWluZXIpXG4gICAgICAgIGNob3JkQm94U3RyaW5nTGFiZWxHcm91cC5hZGQoY2hvcmRCb3hTdHJpbmdMYWJlbFRleHQpXG5cbiAgICAgICAgY2hvcmRCb3hTdHJpbmdMYWJlbENvbnRhaW5lci5iYWNrKClcbiAgICAgICAgY2hvcmRCb3hTdHJpbmdMYWJlbFRleHQuZnJvbnQoKVxuXG4gICAgICAgIGNob3JkQm94U3RyaW5nTGFiZWxHcm91cC5tb3ZlKFxuICAgICAgICAgIHN0cmluZ0xhYmVsSW5kZXgqc3RyaW5nTGFiZWxXaWR0aCxcbiAgICAgICAgICAwLFxuICAgICAgICApXG5cbiAgICAgICAgcmV0dXJuIGNob3JkQm94U3RyaW5nTGFiZWxHcm91cFxuICAgICAgfSlcblxuICAgIGNob3JkQm94U3RyaW5nTGFiZWxzR3JvdXAuYWRkKGNob3JkQm94U3RyaW5nTGFiZWxzQ29udGFpbmVyKVxuXG4gICAgY2hvcmRCb3hTdHJpbmdib2FyZExhYmVsc1xuICAgICAgLm1hcChjaG9yZEJveFN0cmluZ0xhYmVsID0+IHtcbiAgICAgICAgY2hvcmRCb3hTdHJpbmdMYWJlbHNHcm91cC5hZGQoY2hvcmRCb3hTdHJpbmdMYWJlbClcbiAgICAgIH0pXG5cbiAgICBjaG9yZEJveFN0cmluZ0xhYmVsc0NvbnRhaW5lci5iYWNrKClcblxuICAgIGNob3JkQm94U3RyaW5nTGFiZWxzR3JvdXAubW92ZShcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcgKyBDSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzV2lkdGgsXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nICsgQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVIZWlnaHQsXG4gICAgKVxuXG4gICAgcmV0dXJuIGNob3JkQm94U3RyaW5nTGFiZWxzR3JvdXBcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVDaG9yZGJveEJvZHkgKCkge1xuICAgIGNvbnN0IGNob3JkQm94Qm9keUdyb3VwID0gU1ZHKCkuZ3JvdXAoKVxuXG4gICAgY29uc3QgY2hvcmRCb3hCb2R5ID0gU1ZHKClcbiAgICAgIC5yZWN0KFxuICAgICAgICBDSE9SREJPWF9TRVRUSU5HUy53aWR0aC0oMipDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nKS1DSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzV2lkdGgsXG4gICAgICAgIENIT1JEQk9YX1NFVFRJTkdTLmhlaWdodC0oMipDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nKS1DSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodC1DSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHRcbiAgICAgIClcbiAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLmJvZHlGaWxsQ29sb3IpXG5cbiAgICBjaG9yZEJveEJvZHlHcm91cC5hZGQoY2hvcmRCb3hCb2R5KVxuXG4gICAgY2hvcmRCb3hCb2R5R3JvdXAubW92ZShcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcrQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoLFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZytDSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodCtDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHRcbiAgICApXG5cbiAgICByZXR1cm4gY2hvcmRCb3hCb2R5R3JvdXBcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVjaG9yZEJveE51dCAoKSB7XG4gICAgY29uc3QgY2hvcmRCb3hOdXRHcm91cCA9IFNWRygpLmdyb3VwKClcblxuICAgIGNvbnN0IGNob3JkQm94TnV0Q29udGFpbmVyID0gU1ZHKClcbiAgICAgIC5yZWN0KFxuICAgICAgICAoQ0hPUkRCT1hfU0VUVElOR1Mud2lkdGgtKDIqQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyktQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoKS0oMipDSE9SREJPWF9TRVRUSU5HUy5udXRDb250YWluZXJQYWRkaW5nKSxcbiAgICAgICAgQ0hPUkRCT1hfU0VUVElOR1MubnV0SGVpZ2h0XG4gICAgICApXG4gICAgICAuZmlsbCgnbm9uZScpIC8vIGhpZGUgYnkgZGVmYXVsdFxuICAgICAgLnJhZGl1cyhDSE9SREJPWF9TRVRUSU5HUy5udXRSYWRpdXMpXG4gICAgXG4gICAgLy8gdGhlIG51dCBzaG91bGQgb25seSBiZSB2aXNpYmxlIGlmIGJhc2VGcmV0ID09PSAxXG4gICAgaWYgKHRoaXMuY2hvcmRCb3hPcHRpb25zLmJhc2VGcmV0ID09PSAxKSB7XG4gICAgICBjaG9yZEJveE51dENvbnRhaW5lci5maWxsKENIT1JEQk9YX1NFVFRJTkdTLm51dEZpbGxDb2xvcilcbiAgICB9XG5cbiAgICBjaG9yZEJveE51dEdyb3VwLmFkZChjaG9yZEJveE51dENvbnRhaW5lcilcblxuICAgIGNob3JkQm94TnV0R3JvdXAubW92ZShcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcrQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoK0NIT1JEQk9YX1NFVFRJTkdTLm51dENvbnRhaW5lclBhZGRpbmcsXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nK0NIT1JEQk9YX1NFVFRJTkdTLnRpdGxlSGVpZ2h0K0NIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsc0hlaWdodFxuICAgIClcblxuICAgIHJldHVybiBjaG9yZEJveE51dEdyb3VwXG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlY2hvcmRCb3hGcmV0cyAoKSB7XG4gICAgY29uc3QgY2hvcmRCb3hGcmV0c0dyb3VwID0gU1ZHKCkuZ3JvdXAoKVxuXG4gICAgY29uc3QgZnJldHNXaWR0aCA9IChDSE9SREJPWF9TRVRUSU5HUy53aWR0aC0oMipDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nKS1DSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzV2lkdGgpLSgyKkNIT1JEQk9YX1NFVFRJTkdTLm51dENvbnRhaW5lclBhZGRpbmcpXG4gICAgY29uc3QgZnJldHNIZWlnaHQgPSBDSE9SREJPWF9TRVRUSU5HUy5oZWlnaHQtKDIqQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyktQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVIZWlnaHQtQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0LUNIT1JEQk9YX1NFVFRJTkdTLm51dEhlaWdodFxuICAgIGNvbnN0IGZyZXRIZWlnaHQgPSBmcmV0c0hlaWdodC90aGlzLmNob3JkQm94T3B0aW9ucy5mcmV0c1xuXG4gICAgY29uc3QgY2hvcmRCb3hGcmV0c0NvbnRhaW5lciA9IFNWRygpXG4gICAgICAucmVjdChcbiAgICAgICAgZnJldHNXaWR0aCxcbiAgICAgICAgZnJldHNIZWlnaHRcbiAgICAgICkuZmlsbChDSE9SREJPWF9TRVRUSU5HUy5mcmV0c0NvbnRhaW5lckZpbGxDb2xvcilcblxuICAgIGNvbnN0IGNob3JkQm94RnJldE1hcmtlcnMgPSBBcnJheVxuICAgICAgLmZyb20oQXJyYXkodGhpcy5jaG9yZEJveE9wdGlvbnMuZnJldHMpKVxuICAgICAgLm1hcCgoXywgZnJldE1hcmtlckluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGZyZXRNYXJrZXIgPSBTVkcoKVxuICAgICAgICAgIC5yZWN0KFxuICAgICAgICAgICAgZnJldHNXaWR0aCxcbiAgICAgICAgICAgIENIT1JEQk9YX1NFVFRJTkdTLmZyZXRNYXJrZXJIZWlnaHRcbiAgICAgICAgICApXG4gICAgICAgICAgLmZpbGwoQ0hPUkRCT1hfU0VUVElOR1MuZnJldE1hcmtlckZpbGxDb2xvcilcblxuICAgICAgICBmcmV0TWFya2VyLm1vdmUoXG4gICAgICAgICAgMCxcbiAgICAgICAgICBmcmV0TWFya2VySW5kZXgqZnJldEhlaWdodCxcbiAgICAgICAgKVxuXG4gICAgICAgIHJldHVybiBmcmV0TWFya2VyXG4gICAgICB9KVxuXG4gICAgY2hvcmRCb3hGcmV0c0dyb3VwLmFkZChjaG9yZEJveEZyZXRzQ29udGFpbmVyKVxuXG4gICAgY2hvcmRCb3hGcmV0TWFya2Vycy5tYXAoZnJldE1hcmtlciA9PiB7XG4gICAgICBjaG9yZEJveEZyZXRzR3JvdXAuYWRkKGZyZXRNYXJrZXIpXG4gICAgfSlcblxuICAgIGNob3JkQm94RnJldHNHcm91cC5iYWNrKClcblxuICAgIGNob3JkQm94RnJldHNHcm91cC5tb3ZlKFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZytDSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzV2lkdGgrQ0hPUkRCT1hfU0VUVElOR1MubnV0Q29udGFpbmVyUGFkZGluZyxcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcrQ0hPUkRCT1hfU0VUVElOR1MudGl0bGVIZWlnaHQrQ0hPUkRCT1hfU0VUVElOR1Muc3RyaW5nTGFiZWxzSGVpZ2h0K0NIT1JEQk9YX1NFVFRJTkdTLm51dEhlaWdodFxuICAgIClcblxuICAgIHJldHVybiBjaG9yZEJveEZyZXRzR3JvdXBcbiAgfVxuICBcbiAgcHJpdmF0ZSBnZW5lcmF0ZUNob3JkQm94U3RyaW5ncyAoKSB7XG4gICAgY29uc3QgY2hvcmRCb3hTdHJpbmdzR3JvdXAgPSBTVkcoKS5ncm91cCgpXG5cbiAgICBjb25zdCBzdHJpbmdzV2lkdGggPSBDSE9SREJPWF9TRVRUSU5HUy53aWR0aC0oMipDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nKS1DSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzV2lkdGhcbiAgICBjb25zdCBzdHJpbmdzSGVpZ2h0ID0gQ0hPUkRCT1hfU0VUVElOR1MuaGVpZ2h0LSgyKkNIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcpLUNIT1JEQk9YX1NFVFRJTkdTLnRpdGxlSGVpZ2h0LUNIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsc0hlaWdodC1DSE9SREJPWF9TRVRUSU5HUy5udXRIZWlnaHRcbiAgICBjb25zdCBzdHJpbmdXaWR0aCA9IHN0cmluZ3NXaWR0aC90aGlzLmNob3JkQm94T3B0aW9ucy50dW5pbmdzLmxlbmd0aFxuICAgIGNvbnN0IHN0cmluZ0d1YWdlU2NhbGVGYWN0b3IgPSAwLjEyNVxuXG4gICAgY29uc3QgY2hvcmRCb3hTdHJpbmdzQ29udGFpbmVyID0gU1ZHKClcbiAgICAgIC5yZWN0KFxuICAgICAgICBzdHJpbmdzV2lkdGgsXG4gICAgICAgIHN0cmluZ3NIZWlnaHRcbiAgICAgICkuZmlsbCgnbm9uZScpIC8vIHNvIGZyZXRzIHNob3cgdGhyb3VnaFxuXG4gICAgY29uc3QgY2hvcmRCb3hTdHJpbmdzID0gQXJyYXlcbiAgICAgIC5mcm9tKEFycmF5KHRoaXMuY2hvcmRCb3hPcHRpb25zLnR1bmluZ3MubGVuZ3RoKSlcbiAgICAgIC5tYXAoKF8sIHN0cmluZ0luZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IHN0cmluZ0d1YWdlID0gdGhpcy5jaG9yZEJveE9wdGlvbnMuZ3VhZ2VzW3N0cmluZ0luZGV4XSAqIHN0cmluZ0d1YWdlU2NhbGVGYWN0b3JcblxuICAgICAgICBjb25zdCBzdHJpbmcgPSBTVkcoKVxuICAgICAgICAgIC5yZWN0KHN0cmluZ0d1YWdlLCBzdHJpbmdzSGVpZ2h0KVxuICAgICAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0ZpbGxDb2xvcilcblxuICAgICAgICBzdHJpbmcubW92ZShcbiAgICAgICAgICBzdHJpbmdJbmRleCpzdHJpbmdXaWR0aCArIHN0cmluZ1dpZHRoLzIsXG4gICAgICAgICAgMCxcbiAgICAgICAgKVxuXG4gICAgICAgIHJldHVybiBzdHJpbmdcbiAgICAgIH0pXG5cbiAgICBjaG9yZEJveFN0cmluZ3NHcm91cC5hZGQoY2hvcmRCb3hTdHJpbmdzQ29udGFpbmVyKVxuXG4gICAgY2hvcmRCb3hTdHJpbmdzLm1hcChzdHJpbmcgPT4ge1xuICAgICAgY2hvcmRCb3hTdHJpbmdzR3JvdXAuYWRkKHN0cmluZylcbiAgICB9KVxuXG4gICAgY2hvcmRCb3hTdHJpbmdzR3JvdXAuYmFjaygpXG5cbiAgICBjaG9yZEJveFN0cmluZ3NHcm91cC5tb3ZlKFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZytDSE9SREJPWF9TRVRUSU5HUy5mcmV0TGFiZWxzV2lkdGgsXG4gICAgICBDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nK0NIT1JEQk9YX1NFVFRJTkdTLnRpdGxlSGVpZ2h0K0NIT1JEQk9YX1NFVFRJTkdTLnN0cmluZ0xhYmVsc0hlaWdodCtDSE9SREJPWF9TRVRUSU5HUy5udXRIZWlnaHRcbiAgICApXG5cbiAgICByZXR1cm4gY2hvcmRCb3hTdHJpbmdzR3JvdXBcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVDaG9yZEJveERvdHMgKCkge1xuICAgIGNvbnN0IGNob3JkQm94RG90c0dyb3VwID0gU1ZHKCkuZ3JvdXAoKVxuXG4gICAgY29uc3QgZG90c1dpZHRoID0gQ0hPUkRCT1hfU0VUVElOR1Mud2lkdGgtKDIqQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZyktQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoXG4gICAgY29uc3QgZG90c0hlaWdodCA9IENIT1JEQk9YX1NFVFRJTkdTLmhlaWdodC0oMipDSE9SREJPWF9TRVRUSU5HUy5wYWRkaW5nKS1DSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodC1DSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHQtQ0hPUkRCT1hfU0VUVElOR1MubnV0SGVpZ2h0XG4gICAgY29uc3QgZG90V2lkdGggPSBkb3RzV2lkdGgvdGhpcy5jaG9yZEJveE9wdGlvbnMudHVuaW5ncy5sZW5ndGhcbiAgICBjb25zdCBkb3RIZWlnaHQgPSBkb3RzSGVpZ2h0L3RoaXMuY2hvcmRCb3hPcHRpb25zLmZyZXRzXG5cbiAgICBjb25zdCBzdHJpbmdzID0gdGhpcy5jaG9yZEJveE9wdGlvbnMudHVuaW5ncy5sZW5ndGhcbiAgICBjb25zdCBndWFnZXMgPSB0aGlzLmNob3JkQm94T3B0aW9ucy5ndWFnZXNcbiAgICBjb25zdCBzdHJpbmdHdWFnZVNjYWxlRmFjdG9yID0gMC4xMjVcblxuICAgIGNvbnN0IG9wdGlvbnNEb3RzID0gdGhpcy5jaG9yZEJveE9wdGlvbnMuZG90c1xuXG4gICAgY29uc3QgY2hvcmRCb3hEb3RzQ29udGFpbmVyID0gU1ZHKClcbiAgICAgIC5yZWN0KFxuICAgICAgICBkb3RzV2lkdGgsXG4gICAgICAgIGRvdHNIZWlnaHRcbiAgICAgICkuZmlsbCgnbm9uZScpIC8vIHNvIGRvdHMgc2hvdyB0aHJvdWdoXG5cbiAgICBjb25zdCBjaG9yZEJveERvdHMgPSBBcnJheVxuICAgICAgLmZyb20ob3B0aW9uc0RvdHMpXG4gICAgICAubWFwKGRvdCA9PiB7XG4gICAgICAgIGNvbnN0IGRvdEdyb3VwID0gU1ZHKCkuZ3JvdXAoKVxuXG4gICAgICAgIGNvbnN0IGRvdENvbnRhaW5lciA9IFNWRygpXG4gICAgICAgICAgLmNpcmNsZShDSE9SREJPWF9TRVRUSU5HUy5kb3RTaXplKVxuICAgICAgICAgIC5maWxsKENIT1JEQk9YX1NFVFRJTkdTLmRvdEZpbGxDb2xvcilcblxuICAgICAgICBkb3RDb250YWluZXJcbiAgICAgICAgICAuY3goKChzdHJpbmdzIC0gZG90LnN0cmluZykgKiBkb3RXaWR0aCArIGRvdFdpZHRoLzIpICsgKGd1YWdlc1tzdHJpbmdzIC0gZG90LnN0cmluZ10gKiBzdHJpbmdHdWFnZVNjYWxlRmFjdG9yKSAvIDIpXG4gICAgICAgICAgLmN5KChkb3QuZnJldC0xKSAqIGRvdEhlaWdodCArIGRvdEhlaWdodC8yKVxuXG4gICAgICAgIC8vIGR1ZSB0byBvdXIgY29udGFpbmVyIGRpbWVuc2lvbnNcbiAgICAgICAgaWYgKGRvdC5mcmV0ID09PSAxKSB7XG4gICAgICAgICAgZG90Q29udGFpbmVyLmN5KGRvdEhlaWdodC8yICsgQ0hPUkRCT1hfU0VUVElOR1MubnV0SGVpZ2h0LygyKnRoaXMuY2hvcmRCb3hPcHRpb25zLmZyZXRzKSlcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRvdFRleHQgPSBTVkcoKVxuICAgICAgICAgIC50ZXh0KHRoaXMuY2hvcmRCb3hPcHRpb25zLmRvdFRleHQoZG90KSlcbiAgICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAnZm9udC1zaXplJzogQ0hPUkRCT1hfU0VUVElOR1MuZG90Rm9udFNpemUsXG4gICAgICAgICAgICAnZm9udC1mYW1pbHknOiBDSE9SREJPWF9TRVRUSU5HUy5mb250RmFtaWx5XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZmlsbCgnI2ZmZicpXG5cbiAgICAgICAgZG90VGV4dFxuICAgICAgICAgIC5jeCgoKHN0cmluZ3MgLSBkb3Quc3RyaW5nKSAqIGRvdFdpZHRoICsgZG90V2lkdGgvMikgKyAoZ3VhZ2VzW3N0cmluZ3MgLSBkb3Quc3RyaW5nXSAqIHN0cmluZ0d1YWdlU2NhbGVGYWN0b3IpIC8gMilcbiAgICAgICAgICAuY3koKGRvdC5mcmV0LTEpICogZG90SGVpZ2h0ICsgZG90SGVpZ2h0LzIpXG5cbiAgICAgICAgLy8gZHVlIHRvIG91ciBjb250YWluZXIgZGltZW5zaW9uc1xuICAgICAgICBpZiAoZG90LmZyZXQgPT09IDEpIHtcbiAgICAgICAgICBkb3RUZXh0LmN5KGRvdEhlaWdodC8yICsgQ0hPUkRCT1hfU0VUVElOR1MubnV0SGVpZ2h0LygyKnRoaXMuY2hvcmRCb3hPcHRpb25zLmZyZXRzKSlcbiAgICAgICAgfVxuXG4gICAgICAgIGRvdEdyb3VwLmFkZChkb3RDb250YWluZXIpXG4gICAgICAgIGRvdEdyb3VwLmFkZChkb3RUZXh0KVxuXG4gICAgICAgIGRvdENvbnRhaW5lci5iYWNrKClcbiAgICAgICAgZG90VGV4dC5mcm9udCgpXG5cbiAgICAgICAgcmV0dXJuIGRvdEdyb3VwXG4gICAgICB9KVxuXG4gICAgY2hvcmRCb3hEb3RzR3JvdXAuYWRkKGNob3JkQm94RG90c0NvbnRhaW5lcilcblxuICAgIGNob3JkQm94RG90cy5tYXAoZG90ID0+IHtcbiAgICAgIGNob3JkQm94RG90c0dyb3VwLmFkZChkb3QpXG4gICAgfSlcblxuICAgIGNob3JkQm94RG90c0dyb3VwLmJhY2soKVxuXG4gICAgY2hvcmRCb3hEb3RzR3JvdXAubW92ZShcbiAgICAgIENIT1JEQk9YX1NFVFRJTkdTLnBhZGRpbmcrQ0hPUkRCT1hfU0VUVElOR1MuZnJldExhYmVsc1dpZHRoLFxuICAgICAgQ0hPUkRCT1hfU0VUVElOR1MucGFkZGluZytDSE9SREJPWF9TRVRUSU5HUy50aXRsZUhlaWdodCtDSE9SREJPWF9TRVRUSU5HUy5zdHJpbmdMYWJlbHNIZWlnaHQrQ0hPUkRCT1hfU0VUVElOR1MubnV0SGVpZ2h0XG4gICAgKVxuXG4gICAgcmV0dXJuIGNob3JkQm94RG90c0dyb3VwXG4gIH1cblxuICBzZXRGb250c0RpciAoZm9udHNEaXI6IHN0cmluZyA9IHJlc29sdmUoX19kaXJuYW1lLCAnLi9hc3NldHMvZm9udHMnKSkge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIGNvbmZpZy5zZXRGb250RGlyKGZvbnRzRGlyKVxuXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIHNldERvdHMgKGRvdHM6IENob3JkQm94RG90W10pIHtcbiAgICB0aGlzLmNob3JkQm94T3B0aW9ucy5kb3RzID0gZG90c1xuXG4gICAgdGhpcy5yZW5kZXIoKVxuXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuICBcbiAgcmVuZGVyICgpIHtcbiAgICAvLyBhbHdheXMgY2xlYXIgdGhlIHJlbmRlcmVyXG4gICAgdGhpcy5yZW5kZXJlci5jbGVhcigpXG5cbiAgICAvLyBidWlsZCBpdCB1cCBpbiBsYXllcnNcbiAgICB0aGlzLnJlbmRlcmVyLmFkZCh0aGlzLmdlbmVyYXRlQ2hvcmRCb3hCYXNlKCkpXG4gICAgdGhpcy5yZW5kZXJlci5hZGQodGhpcy5nZW5lcmF0ZUNob3JkQm94VGl0bGUoKSlcblxuICAgIHRoaXMucmVuZGVyZXIuYWRkKHRoaXMuZ2VuZXJhdGVjaG9yZEJveEZyZXRMYWJlbHMoKSlcbiAgICB0aGlzLnJlbmRlcmVyLmFkZCh0aGlzLmdlbmVyYXRlY2hvcmRCb3hTdHJpbmdMYWJlbHMoKSlcblxuICAgIC8vIC8vIGJ1aWxkIHRoZSBib2R5IHBhcnRzXG4gICAgdGhpcy5yZW5kZXJlci5hZGQodGhpcy5nZW5lcmF0ZUNob3JkYm94Qm9keSgpKVxuICAgIHRoaXMucmVuZGVyZXIuYWRkKHRoaXMuZ2VuZXJhdGVjaG9yZEJveE51dCgpKVxuICAgIHRoaXMucmVuZGVyZXIuYWRkKHRoaXMuZ2VuZXJhdGVjaG9yZEJveEZyZXRzKCkpXG4gICAgdGhpcy5yZW5kZXJlci5hZGQodGhpcy5nZW5lcmF0ZUNob3JkQm94U3RyaW5ncygpKVxuICAgIHRoaXMucmVuZGVyZXIuYWRkKHRoaXMuZ2VuZXJhdGVDaG9yZEJveERvdHMoKSlcblxuICAgIC8vIGZpeGVzIGNocm9tZSByZW5kZXJpbmcgaXNzdWVcbiAgICB0aGlzLnJlbmRlcmVyXG4gICAgICAuYXR0cih7XG4gICAgICAgIHdpZHRoOiBDSE9SREJPWF9TRVRUSU5HUy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBDSE9SREJPWF9TRVRUSU5HUy5oZWlnaHQsXG4gICAgICB9KVxuXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIHRvU1ZHICgpIHtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5zdmcoKVxuICB9XG5cbiAgdG9TVkdCYXNlNjRVUkkgKCkge1xuICAgIHJldHVybiBgZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwke0J1ZmZlci5mcm9tKHRoaXMucmVuZGVyZXIuc3ZnKCkpLnRvU3RyaW5nKFwiYmFzZTY0XCIpfWBcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB7IENob3JkQm94IH1cbmV4cG9ydCB7IENob3JkQm94IH0iXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwiZ2xvYmFsIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInJlcXVpcmUiLCJjb25maWciLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwic2V0Rm9udEZhbWlseU1hcHBpbmdzIiwid2luZG93IiwiY3JlYXRlU1ZHV2luZG93IiwiZG9jdW1lbnQiLCJyZWdpc3RlcldpbmRvdyIsIkNob3JkQm94T3B0aW9uc0RlZmF1bHRzIiwidGl0bGUiLCJmcmV0cyIsImJhc2VGcmV0IiwiZG90cyIsImRvdFRleHQiLCJ0dW5pbmdzIiwiZ3VhZ2VzIiwiQ0hPUkRCT1hfU0VUVElOR1MiLCJDaG9yZEJveCIsImNob3JkQm94T3B0aW9ucyIsInRoaXMiLCJyZW5kZXJlciIsIlNWRyIsInZhbGlkYXRlQ2hvcmRCb3hPcHRpb25zIiwiRXJyb3IiLCJsZW5ndGgiLCJjaG9yZEJveEJhc2VHcm91cCIsImdyb3VwIiwiY2hvcmRCb3hCYXNlQ29udGFpbmVyIiwicmVjdCIsInJhZGl1cyIsImZpbGwiLCJjaG9yZEJveEJhc2UiLCJhZGQiLCJiYWNrIiwiZnJvbnQiLCJtb3ZlIiwiY2hvcmRCb3hUaXRsZUdyb3VwIiwiY2hvcmRCb3hUaXRsZUNvbnRhaW5lciIsIkNob3JkQm94VGl0bGUiLCJ0ZXh0IiwiYXR0ciIsImN4IiwiY3kiLCJjaG9yZEJveEZyZXRMYWJlbHNHcm91cCIsImZyZXRMYWJlbEhlaWdodCIsImNob3JkQm94RnJldExhYmVsc0NvbnRhaW5lciIsImNob3JkQm94RnJldGJvYXJkTGFiZWxzIiwiQXJyYXkiLCJmcm9tIiwibWFwIiwiXyIsImZyZXRMYWJlbEluZGV4IiwiY2hvcmRCb3hGcmV0TGFiZWxHcm91cCIsImNob3JkQm94RnJldExhYmVsQ29udGFpbmVyIiwiY2hvcmRCb3hGcmV0TGFiZWxUZXh0IiwidG9TdHJpbmciLCJjaG9yZEJveEZyZXRMYWJlbCIsImNob3JkQm94U3RyaW5nTGFiZWxzR3JvdXAiLCJzdHJpbmdMYWJlbFdpZHRoIiwiY2hvcmRCb3hTdHJpbmdMYWJlbHNDb250YWluZXIiLCJjaG9yZEJveFN0cmluZ2JvYXJkTGFiZWxzIiwic3RyaW5nTGFiZWxJbmRleCIsImNob3JkQm94U3RyaW5nTGFiZWxHcm91cCIsImNob3JkQm94U3RyaW5nTGFiZWxDb250YWluZXIiLCJjaG9yZEJveFN0cmluZ0xhYmVsVGV4dCIsImNob3JkQm94U3RyaW5nTGFiZWwiLCJjaG9yZEJveEJvZHlHcm91cCIsImNob3JkQm94Qm9keSIsImNob3JkQm94TnV0R3JvdXAiLCJjaG9yZEJveE51dENvbnRhaW5lciIsImNob3JkQm94RnJldHNHcm91cCIsImZyZXRIZWlnaHQiLCJjaG9yZEJveEZyZXRzQ29udGFpbmVyIiwiY2hvcmRCb3hGcmV0TWFya2VycyIsImZyZXRNYXJrZXJJbmRleCIsImZyZXRNYXJrZXIiLCJjaG9yZEJveFN0cmluZ3NHcm91cCIsInN0cmluZ1dpZHRoIiwiY2hvcmRCb3hTdHJpbmdzQ29udGFpbmVyIiwiY2hvcmRCb3hTdHJpbmdzIiwic3RyaW5nSW5kZXgiLCJzdHJpbmdHdWFnZSIsInN0cmluZyIsImNob3JkQm94RG90c0dyb3VwIiwiZG90V2lkdGgiLCJkb3RIZWlnaHQiLCJzdHJpbmdzIiwib3B0aW9uc0RvdHMiLCJjaG9yZEJveERvdHNDb250YWluZXIiLCJjaG9yZEJveERvdHMiLCJkb3QiLCJkb3RHcm91cCIsImRvdENvbnRhaW5lciIsImNpcmNsZSIsImZyZXQiLCJmb250c0RpciIsInJlbmRlciIsImNsZWFyIiwiZ2VuZXJhdGVDaG9yZEJveEJhc2UiLCJnZW5lcmF0ZUNob3JkQm94VGl0bGUiLCJnZW5lcmF0ZWNob3JkQm94RnJldExhYmVscyIsImdlbmVyYXRlY2hvcmRCb3hTdHJpbmdMYWJlbHMiLCJnZW5lcmF0ZUNob3JkYm94Qm9keSIsImdlbmVyYXRlY2hvcmRCb3hOdXQiLCJnZW5lcmF0ZWNob3JkQm94RnJldHMiLCJnZW5lcmF0ZUNob3JkQm94U3RyaW5ncyIsImdlbmVyYXRlQ2hvcmRCb3hEb3RzIiwid2lkdGgiLCJoZWlnaHQiLCJzdmciLCJCdWZmZXIiXSwic291cmNlUm9vdCI6IiJ9